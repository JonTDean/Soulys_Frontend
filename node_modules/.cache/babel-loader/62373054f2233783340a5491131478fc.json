{"ast":null,"code":"import Canvas from '../canvas/Canvas.js';\nimport DrawCircle from './drawmethods/DrawCircle.js';\nimport DrawEllipse from './drawmethods/DrawEllipse.js';\nimport DrawRoundRectangle from './drawmethods/DrawRoundRectangle.js';\nconst GetValue = Phaser.Utils.Objects.GetValue;\n\nclass CircleMaskImage extends Canvas {\n  constructor(scene, x, y, key, frame, config) {\n    super(scene, x, y);\n    this.type = 'rexCircleMaskImage';\n    this.setTexture(key, frame, config);\n  }\n\n  setTexture(key, frame, config) {\n    if (typeof frame === 'object') {\n      config = frame;\n      frame = undefined;\n    }\n\n    var maskType, backgroundColor;\n\n    if (typeof config === 'string') {\n      maskType = config;\n      backgroundColor = undefined;\n    } else {\n      maskType = GetValue(config, 'maskType', 0);\n      backgroundColor = GetValue(config, 'backgroundColor', undefined);\n    }\n\n    if (maskType === undefined) {\n      maskType = 0;\n    } else if (typeof maskType === 'string') {\n      maskType = MASKTYPE[maskType];\n    }\n\n    this._textureKey = key;\n    this._frameName = frame;\n\n    if (maskType === null) {\n      this.loadTexture(key, frame);\n      this.dirty = true;\n      return this;\n    }\n\n    var HasBackgroundColor = backgroundColor != null;\n\n    if (!HasBackgroundColor) {\n      // No background color -- draw image first\n      this.loadTexture(key, frame);\n    } // Draw mask\n\n\n    var canvas = this.canvas,\n        ctx = this.context;\n    var width = canvas.width,\n        height = canvas.height;\n    ctx.save();\n    ctx.globalCompositeOperation = HasBackgroundColor ? 'source-over' : 'destination-in';\n    ctx.beginPath(); // Draw circle, ellipse, or roundRectangle\n\n    switch (maskType) {\n      case 0:\n        DrawCircle(ctx, width, height);\n        break;\n\n      case 1:\n        DrawEllipse(ctx, width, height);\n        break;\n\n      case 2:\n        var radiusConfig = GetValue(config, 'radius', undefined);\n        DrawRoundRectangle(ctx, width, height, radiusConfig);\n        break;\n    }\n\n    if (HasBackgroundColor) {\n      ctx.fillStyle = backgroundColor;\n    }\n\n    ctx.fill();\n    ctx.restore();\n\n    if (HasBackgroundColor) {\n      // Has background color -- draw image last\n      ctx.save();\n      ctx.globalCompositeOperation = 'destination-atop';\n      this.loadTexture(key, frame);\n      ctx.restore();\n    }\n\n    this.dirty = true;\n    return this;\n  }\n\n}\n\nconst MASKTYPE = {\n  circle: 0,\n  ellipse: 1,\n  roundRectangle: 2\n};\nexport default CircleMaskImage;","map":{"version":3,"sources":["/home/jon/code/Projects/Soulys/frontend/node_modules/phaser3-rex-plugins/plugins/gameobjects/circlemaskimage/CircleMaskImage.js"],"names":["Canvas","DrawCircle","DrawEllipse","DrawRoundRectangle","GetValue","Phaser","Utils","Objects","CircleMaskImage","constructor","scene","x","y","key","frame","config","type","setTexture","undefined","maskType","backgroundColor","MASKTYPE","_textureKey","_frameName","loadTexture","dirty","HasBackgroundColor","canvas","ctx","context","width","height","save","globalCompositeOperation","beginPath","radiusConfig","fillStyle","fill","restore","circle","ellipse","roundRectangle"],"mappings":"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","sourcesContent":["import Canvas from '../canvas/Canvas.js';\r\nimport DrawCircle from './drawmethods/DrawCircle.js';\r\nimport DrawEllipse from './drawmethods/DrawEllipse.js';\r\nimport DrawRoundRectangle from './drawmethods/DrawRoundRectangle.js';\r\n\r\nconst GetValue = Phaser.Utils.Objects.GetValue;\r\n\r\nclass CircleMaskImage extends Canvas {\r\n    constructor(scene, x, y, key, frame, config) {\r\n        super(scene, x, y);\r\n\r\n        this.type = 'rexCircleMaskImage';\r\n        this.setTexture(key, frame, config);\r\n    }\r\n\r\n    setTexture(key, frame, config) {\r\n        if (typeof (frame) === 'object') {\r\n            config = frame;\r\n            frame = undefined;\r\n        }\r\n\r\n        var maskType, backgroundColor;\r\n        if (typeof (config) === 'string') {\r\n            maskType = config;\r\n            backgroundColor = undefined;\r\n        } else {\r\n            maskType = GetValue(config, 'maskType', 0);\r\n            backgroundColor = GetValue(config, 'backgroundColor', undefined);\r\n        }\r\n\r\n        if (maskType === undefined) {\r\n            maskType = 0;\r\n        } else if (typeof (maskType) === 'string') {\r\n            maskType = MASKTYPE[maskType];\r\n        }\r\n\r\n        this._textureKey = key;\r\n        this._frameName = frame;\r\n\r\n        if (maskType === null) {\r\n            this.loadTexture(key, frame);\r\n            this.dirty = true;\r\n            return this;\r\n        }\r\n\r\n        var HasBackgroundColor = (backgroundColor != null);\r\n        if (!HasBackgroundColor) { // No background color -- draw image first\r\n            this.loadTexture(key, frame);\r\n        }\r\n\r\n        // Draw mask\r\n        var canvas = this.canvas,\r\n            ctx = this.context;\r\n        var width = canvas.width,\r\n            height = canvas.height;\r\n\r\n        ctx.save();\r\n        ctx.globalCompositeOperation = (HasBackgroundColor) ? 'source-over' : 'destination-in';\r\n        ctx.beginPath();\r\n\r\n        // Draw circle, ellipse, or roundRectangle\r\n        switch (maskType) {\r\n            case 0:\r\n                DrawCircle(ctx, width, height);\r\n                break;\r\n            case 1:\r\n                DrawEllipse(ctx, width, height);\r\n                break;\r\n            case 2:\r\n                var radiusConfig = GetValue(config, 'radius', undefined);\r\n                DrawRoundRectangle(ctx, width, height, radiusConfig);\r\n                break;\r\n        }\r\n\r\n        if (HasBackgroundColor) {\r\n            ctx.fillStyle = backgroundColor;\r\n        }\r\n        ctx.fill();\r\n        ctx.restore();\r\n\r\n        if (HasBackgroundColor) {  // Has background color -- draw image last\r\n            ctx.save();\r\n            ctx.globalCompositeOperation = 'destination-atop';\r\n            this.loadTexture(key, frame);\r\n            ctx.restore();\r\n        }\r\n\r\n        this.dirty = true;\r\n        return this;\r\n    }\r\n}\r\n\r\nconst MASKTYPE = {\r\n    circle: 0,\r\n    ellipse: 1,\r\n    roundRectangle: 2\r\n}\r\n\r\nexport default CircleMaskImage;"]},"metadata":{},"sourceType":"module"}