{"ast":null,"code":"import EventEmitterMethods from '../../utils/eventemitter/EventEmitterMethods.js';\nimport GetValue from '../../utils/object/GetValue.js';\n\nclass FSM {\n  /*\r\n  var config = {\r\n      start: 'A',   // default: undefined\r\n      states: {\r\n          A: {\r\n              next: 'B',  // function() { return 'B'; }\r\n              enter: function() {},\r\n              exit: function() {}\r\n          },\r\n          // ...\r\n      },        \r\n      extend: {\r\n          i: 0,\r\n          name: 'abc'\r\n          // ...\r\n      },\r\n      init: function() {},\r\n      enable: true,\r\n      eventEmitter: true,\r\n  };\r\n  */\n  constructor(config) {\n    // Attach get-next-state function\n    var states = GetValue(config, 'states', undefined);\n\n    if (states) {\n      this.addStates(states);\n    } // Attach extend members\n\n\n    var extend = GetValue(config, 'extend', undefined);\n\n    if (extend) {\n      for (var name in extend) {\n        if (!this.hasOwnProperty(name) || this[name] === undefined) {\n          this[name] = extend[name];\n        }\n      }\n    } // Event emitter\n\n\n    var eventEmitter = GetValue(config, 'eventEmitter', undefined);\n    var EventEmitterClass = GetValue(config, 'EventEmitterClass', undefined);\n    this.setEventEmitter(eventEmitter, EventEmitterClass);\n    this._stateLock = false;\n    this.resetFromJSON(config);\n  }\n\n  shutdown() {\n    this.destroyEventEmitter();\n  }\n\n  destroy() {\n    this.shutdown();\n  }\n\n  resetFromJSON(o) {\n    this.setEnable(GetValue(o, 'enable', true));\n    this.start(GetValue(o, 'start', undefined));\n    var init = GetValue(o, 'init', undefined);\n\n    if (init) {\n      init.call(this);\n    }\n\n    return this;\n  }\n\n  toJSON() {\n    return {\n      curState: this.state,\n      prevState: this.prevState,\n      enable: this.enable,\n      start: this._start\n    };\n  }\n\n  setEnable(e) {\n    if (e === undefined) {\n      e = true;\n    }\n\n    this.enable = e;\n    return this;\n  }\n\n  set state(newState) {\n    if (!this.enable || this._stateLock) {\n      return;\n    }\n\n    if (this._state === newState) {\n      return;\n    }\n\n    this._prevState = this._state;\n    this._state = newState;\n    this._stateLock = true; // lock state\n\n    this.emit('statechange', this);\n\n    if (this._prevState != null) {\n      var exitEventName = 'exit_' + this._prevState;\n      var exitCallback = this[exitEventName];\n\n      if (exitCallback) {\n        exitCallback.call(this);\n      }\n\n      this.emit(exitEventName, this);\n    }\n\n    this._stateLock = false;\n\n    if (this._state != null) {\n      var enterEventName = 'enter_' + this._state;\n      var enterCallback = this[enterEventName];\n\n      if (enterCallback) {\n        enterCallback.call(this);\n      }\n\n      this.emit(enterEventName, this);\n    }\n  }\n\n  get state() {\n    return this._state;\n  }\n\n  get prevState() {\n    return this._prevState;\n  }\n\n  start(state) {\n    this._start = state;\n    this._prevState = undefined;\n    this._state = state; // Won't fire statechange events\n\n    return this;\n  }\n\n  goto(nextState) {\n    if (nextState != null) {\n      this.state = nextState;\n    }\n\n    return this;\n  }\n\n  next() {\n    var nextState;\n    var getNextState = this['next_' + this.state];\n\n    if (getNextState) {\n      if (typeof getNextState === 'string') {\n        nextState = getNextState;\n      } else {\n        nextState = getNextState.call(this);\n      }\n    }\n\n    this.goto(nextState);\n    return this;\n  }\n\n  addState(name, config) {\n    var getNextStateCallback = GetValue(config, 'next', undefined);\n\n    if (getNextStateCallback) {\n      this['next_' + name] = getNextStateCallback;\n    }\n\n    var exitCallback = GetValue(config, 'exit', undefined);\n\n    if (exitCallback) {\n      this['exit_' + name] = exitCallback;\n    }\n\n    var enterCallback = GetValue(config, 'enter', undefined);\n\n    if (enterCallback) {\n      this['enter_' + name] = enterCallback;\n    }\n\n    return this;\n  }\n\n  addStates(states) {\n    for (var name in states) {\n      this.addState(name, states[name]);\n    }\n\n    return this;\n  }\n\n  update(time, delta, key) {\n    if (key === undefined) {\n      key = 'update';\n    }\n\n    var fn = this[key + '_' + this.state];\n\n    if (fn) {\n      fn.call(this, time, delta);\n    }\n  }\n\n  preupdate(time, delta) {\n    this.update(time, delta, 'preupdate');\n  }\n\n  postupdate(time, delta) {\n    this.update(time, delta, 'postupdate');\n  }\n\n}\n\nObject.assign(FSM.prototype, EventEmitterMethods);\nexport default FSM;","map":{"version":3,"sources":["/home/jon/code/Projects/Soulys/frontend/node_modules/phaser3-rex-plugins/plugins/logic/fsm/FSM.js"],"names":["EventEmitterMethods","GetValue","FSM","constructor","config","states","undefined","addStates","extend","name","hasOwnProperty","eventEmitter","EventEmitterClass","setEventEmitter","_stateLock","resetFromJSON","shutdown","destroyEventEmitter","destroy","o","setEnable","start","init","call","toJSON","curState","state","prevState","enable","_start","e","newState","_state","_prevState","emit","exitEventName","exitCallback","enterEventName","enterCallback","goto","nextState","next","getNextState","addState","getNextStateCallback","update","time","delta","key","fn","preupdate","postupdate","Object","assign","prototype"],"mappings":"AAAA,OAAOA,mBAAP,MAAgC,iDAAhC;AACA,OAAOC,QAAP,MAAqB,gCAArB;;AAEA,MAAMC,GAAN,CAAU;AACN;;;;;;;;;;;;;;;;;;;;;AAqBAC,EAAAA,WAAW,CAACC,MAAD,EAAS;AAChB;AACA,QAAIC,MAAM,GAAGJ,QAAQ,CAACG,MAAD,EAAS,QAAT,EAAmBE,SAAnB,CAArB;;AACA,QAAID,MAAJ,EAAY;AACR,WAAKE,SAAL,CAAeF,MAAf;AACH,KALe,CAOhB;;;AACA,QAAIG,MAAM,GAAGP,QAAQ,CAACG,MAAD,EAAS,QAAT,EAAmBE,SAAnB,CAArB;;AACA,QAAIE,MAAJ,EAAY;AACR,WAAK,IAAIC,IAAT,IAAiBD,MAAjB,EAAyB;AACrB,YAAI,CAAC,KAAKE,cAAL,CAAoBD,IAApB,CAAD,IAA8B,KAAKA,IAAL,MAAeH,SAAjD,EAA4D;AACxD,eAAKG,IAAL,IAAaD,MAAM,CAACC,IAAD,CAAnB;AACH;AACJ;AACJ,KAfe,CAiBhB;;;AACA,QAAIE,YAAY,GAAGV,QAAQ,CAACG,MAAD,EAAS,cAAT,EAAyBE,SAAzB,CAA3B;AACA,QAAIM,iBAAiB,GAAGX,QAAQ,CAACG,MAAD,EAAS,mBAAT,EAA8BE,SAA9B,CAAhC;AACA,SAAKO,eAAL,CAAqBF,YAArB,EAAmCC,iBAAnC;AAEA,SAAKE,UAAL,GAAkB,KAAlB;AACA,SAAKC,aAAL,CAAmBX,MAAnB;AACH;;AAEDY,EAAAA,QAAQ,GAAG;AACP,SAAKC,mBAAL;AACH;;AAEDC,EAAAA,OAAO,GAAG;AACN,SAAKF,QAAL;AACH;;AAEDD,EAAAA,aAAa,CAACI,CAAD,EAAI;AACb,SAAKC,SAAL,CAAenB,QAAQ,CAACkB,CAAD,EAAI,QAAJ,EAAc,IAAd,CAAvB;AACA,SAAKE,KAAL,CAAWpB,QAAQ,CAACkB,CAAD,EAAI,OAAJ,EAAab,SAAb,CAAnB;AACA,QAAIgB,IAAI,GAAGrB,QAAQ,CAACkB,CAAD,EAAI,MAAJ,EAAYb,SAAZ,CAAnB;;AACA,QAAIgB,IAAJ,EAAU;AACNA,MAAAA,IAAI,CAACC,IAAL,CAAU,IAAV;AACH;;AACD,WAAO,IAAP;AACH;;AAEDC,EAAAA,MAAM,GAAG;AACL,WAAO;AACHC,MAAAA,QAAQ,EAAE,KAAKC,KADZ;AAEHC,MAAAA,SAAS,EAAE,KAAKA,SAFb;AAIHC,MAAAA,MAAM,EAAE,KAAKA,MAJV;AAKHP,MAAAA,KAAK,EAAE,KAAKQ;AALT,KAAP;AAOH;;AAEDT,EAAAA,SAAS,CAACU,CAAD,EAAI;AACT,QAAIA,CAAC,KAAKxB,SAAV,EAAqB;AACjBwB,MAAAA,CAAC,GAAG,IAAJ;AACH;;AACD,SAAKF,MAAL,GAAcE,CAAd;AACA,WAAO,IAAP;AACH;;AAED,MAAIJ,KAAJ,CAAUK,QAAV,EAAoB;AAChB,QAAI,CAAC,KAAKH,MAAN,IAAgB,KAAKd,UAAzB,EAAqC;AACjC;AACH;;AACD,QAAI,KAAKkB,MAAL,KAAgBD,QAApB,EAA8B;AAC1B;AACH;;AACD,SAAKE,UAAL,GAAkB,KAAKD,MAAvB;AACA,SAAKA,MAAL,GAAcD,QAAd;AAEA,SAAKjB,UAAL,GAAkB,IAAlB,CAVgB,CAUQ;;AAExB,SAAKoB,IAAL,CAAU,aAAV,EAAyB,IAAzB;;AAEA,QAAI,KAAKD,UAAL,IAAmB,IAAvB,EAA6B;AACzB,UAAIE,aAAa,GAAG,UAAU,KAAKF,UAAnC;AACA,UAAIG,YAAY,GAAG,KAAKD,aAAL,CAAnB;;AACA,UAAIC,YAAJ,EAAkB;AACdA,QAAAA,YAAY,CAACb,IAAb,CAAkB,IAAlB;AACH;;AACD,WAAKW,IAAL,CAAUC,aAAV,EAAyB,IAAzB;AACH;;AAED,SAAKrB,UAAL,GAAkB,KAAlB;;AAEA,QAAI,KAAKkB,MAAL,IAAe,IAAnB,EAAyB;AACrB,UAAIK,cAAc,GAAG,WAAW,KAAKL,MAArC;AACA,UAAIM,aAAa,GAAG,KAAKD,cAAL,CAApB;;AACA,UAAIC,aAAJ,EAAmB;AACfA,QAAAA,aAAa,CAACf,IAAd,CAAmB,IAAnB;AACH;;AACD,WAAKW,IAAL,CAAUG,cAAV,EAA0B,IAA1B;AACH;AACJ;;AAED,MAAIX,KAAJ,GAAY;AACR,WAAO,KAAKM,MAAZ;AACH;;AAED,MAAIL,SAAJ,GAAgB;AACZ,WAAO,KAAKM,UAAZ;AACH;;AAEDZ,EAAAA,KAAK,CAACK,KAAD,EAAQ;AACT,SAAKG,MAAL,GAAcH,KAAd;AACA,SAAKO,UAAL,GAAkB3B,SAAlB;AACA,SAAK0B,MAAL,GAAcN,KAAd,CAHS,CAGY;;AACrB,WAAO,IAAP;AACH;;AAEDa,EAAAA,IAAI,CAACC,SAAD,EAAY;AACZ,QAAIA,SAAS,IAAI,IAAjB,EAAuB;AACnB,WAAKd,KAAL,GAAac,SAAb;AACH;;AACD,WAAO,IAAP;AACH;;AAEDC,EAAAA,IAAI,GAAG;AACH,QAAID,SAAJ;AACA,QAAIE,YAAY,GAAG,KAAK,UAAU,KAAKhB,KAApB,CAAnB;;AACA,QAAIgB,YAAJ,EAAkB;AACd,UAAI,OAAQA,YAAR,KAA0B,QAA9B,EAAwC;AACpCF,QAAAA,SAAS,GAAGE,YAAZ;AACH,OAFD,MAEO;AACHF,QAAAA,SAAS,GAAGE,YAAY,CAACnB,IAAb,CAAkB,IAAlB,CAAZ;AACH;AACJ;;AAED,SAAKgB,IAAL,CAAUC,SAAV;AACA,WAAO,IAAP;AACH;;AAEDG,EAAAA,QAAQ,CAAClC,IAAD,EAAOL,MAAP,EAAe;AACnB,QAAIwC,oBAAoB,GAAG3C,QAAQ,CAACG,MAAD,EAAS,MAAT,EAAiBE,SAAjB,CAAnC;;AACA,QAAIsC,oBAAJ,EAA0B;AACtB,WAAK,UAAUnC,IAAf,IAAuBmC,oBAAvB;AACH;;AAED,QAAIR,YAAY,GAAGnC,QAAQ,CAACG,MAAD,EAAS,MAAT,EAAiBE,SAAjB,CAA3B;;AACA,QAAI8B,YAAJ,EAAkB;AACd,WAAK,UAAU3B,IAAf,IAAuB2B,YAAvB;AACH;;AAED,QAAIE,aAAa,GAAGrC,QAAQ,CAACG,MAAD,EAAS,OAAT,EAAkBE,SAAlB,CAA5B;;AACA,QAAIgC,aAAJ,EAAmB;AACf,WAAK,WAAW7B,IAAhB,IAAwB6B,aAAxB;AACH;;AACD,WAAO,IAAP;AACH;;AAED/B,EAAAA,SAAS,CAACF,MAAD,EAAS;AACd,SAAK,IAAII,IAAT,IAAiBJ,MAAjB,EAAyB;AACrB,WAAKsC,QAAL,CAAclC,IAAd,EAAoBJ,MAAM,CAACI,IAAD,CAA1B;AACH;;AACD,WAAO,IAAP;AACH;;AAEDoC,EAAAA,MAAM,CAACC,IAAD,EAAOC,KAAP,EAAcC,GAAd,EAAmB;AACrB,QAAIA,GAAG,KAAK1C,SAAZ,EAAuB;AACnB0C,MAAAA,GAAG,GAAG,QAAN;AACH;;AACD,QAAIC,EAAE,GAAG,KAAKD,GAAG,GAAG,GAAN,GAAY,KAAKtB,KAAtB,CAAT;;AACA,QAAIuB,EAAJ,EAAQ;AACJA,MAAAA,EAAE,CAAC1B,IAAH,CAAQ,IAAR,EAAcuB,IAAd,EAAoBC,KAApB;AACH;AACJ;;AAEDG,EAAAA,SAAS,CAACJ,IAAD,EAAOC,KAAP,EAAc;AACnB,SAAKF,MAAL,CAAYC,IAAZ,EAAkBC,KAAlB,EAAyB,WAAzB;AACH;;AAEDI,EAAAA,UAAU,CAACL,IAAD,EAAOC,KAAP,EAAc;AACpB,SAAKF,MAAL,CAAYC,IAAZ,EAAkBC,KAAlB,EAAyB,YAAzB;AACH;;AArMK;;AAwMVK,MAAM,CAACC,MAAP,CACInD,GAAG,CAACoD,SADR,EAEItD,mBAFJ;AAKA,eAAeE,GAAf","sourcesContent":["import EventEmitterMethods from '../../utils/eventemitter/EventEmitterMethods.js';\r\nimport GetValue from '../../utils/object/GetValue.js';\r\n\r\nclass FSM {\r\n    /*\r\n    var config = {\r\n        start: 'A',   // default: undefined\r\n        states: {\r\n            A: {\r\n                next: 'B',  // function() { return 'B'; }\r\n                enter: function() {},\r\n                exit: function() {}\r\n            },\r\n            // ...\r\n        },        \r\n        extend: {\r\n            i: 0,\r\n            name: 'abc'\r\n            // ...\r\n        },\r\n        init: function() {},\r\n        enable: true,\r\n        eventEmitter: true,\r\n    };\r\n    */\r\n    constructor(config) {\r\n        // Attach get-next-state function\r\n        var states = GetValue(config, 'states', undefined);\r\n        if (states) {\r\n            this.addStates(states);\r\n        }\r\n\r\n        // Attach extend members\r\n        var extend = GetValue(config, 'extend', undefined);\r\n        if (extend) {\r\n            for (var name in extend) {\r\n                if (!this.hasOwnProperty(name) || this[name] === undefined) {\r\n                    this[name] = extend[name];\r\n                }\r\n            }\r\n        }\r\n\r\n        // Event emitter\r\n        var eventEmitter = GetValue(config, 'eventEmitter', undefined);\r\n        var EventEmitterClass = GetValue(config, 'EventEmitterClass', undefined);\r\n        this.setEventEmitter(eventEmitter, EventEmitterClass);\r\n\r\n        this._stateLock = false;\r\n        this.resetFromJSON(config);\r\n    }\r\n\r\n    shutdown() {\r\n        this.destroyEventEmitter();\r\n    }\r\n\r\n    destroy() {\r\n        this.shutdown();\r\n    }\r\n\r\n    resetFromJSON(o) {\r\n        this.setEnable(GetValue(o, 'enable', true));\r\n        this.start(GetValue(o, 'start', undefined));\r\n        var init = GetValue(o, 'init', undefined);\r\n        if (init) {\r\n            init.call(this);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            curState: this.state,\r\n            prevState: this.prevState,\r\n\r\n            enable: this.enable,\r\n            start: this._start\r\n        };\r\n    }\r\n\r\n    setEnable(e) {\r\n        if (e === undefined) {\r\n            e = true;\r\n        }\r\n        this.enable = e;\r\n        return this;\r\n    }\r\n\r\n    set state(newState) {\r\n        if (!this.enable || this._stateLock) {\r\n            return;\r\n        }\r\n        if (this._state === newState) {\r\n            return;\r\n        }\r\n        this._prevState = this._state;\r\n        this._state = newState;\r\n\r\n        this._stateLock = true; // lock state\r\n\r\n        this.emit('statechange', this);\r\n\r\n        if (this._prevState != null) {\r\n            var exitEventName = 'exit_' + this._prevState;\r\n            var exitCallback = this[exitEventName];\r\n            if (exitCallback) {\r\n                exitCallback.call(this);\r\n            }\r\n            this.emit(exitEventName, this);\r\n        }\r\n\r\n        this._stateLock = false;\r\n\r\n        if (this._state != null) {\r\n            var enterEventName = 'enter_' + this._state;\r\n            var enterCallback = this[enterEventName];\r\n            if (enterCallback) {\r\n                enterCallback.call(this);\r\n            }\r\n            this.emit(enterEventName, this);\r\n        }\r\n    }\r\n\r\n    get state() {\r\n        return this._state;\r\n    }\r\n\r\n    get prevState() {\r\n        return this._prevState;\r\n    }\r\n\r\n    start(state) {\r\n        this._start = state;\r\n        this._prevState = undefined;\r\n        this._state = state; // Won't fire statechange events\r\n        return this;\r\n    }\r\n\r\n    goto(nextState) {\r\n        if (nextState != null) {\r\n            this.state = nextState;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    next() {\r\n        var nextState;\r\n        var getNextState = this['next_' + this.state];\r\n        if (getNextState) {\r\n            if (typeof (getNextState) === 'string') {\r\n                nextState = getNextState;\r\n            } else {\r\n                nextState = getNextState.call(this);\r\n            }\r\n        }\r\n\r\n        this.goto(nextState);\r\n        return this;\r\n    }\r\n\r\n    addState(name, config) {\r\n        var getNextStateCallback = GetValue(config, 'next', undefined);\r\n        if (getNextStateCallback) {\r\n            this['next_' + name] = getNextStateCallback;\r\n        }\r\n\r\n        var exitCallback = GetValue(config, 'exit', undefined);\r\n        if (exitCallback) {\r\n            this['exit_' + name] = exitCallback;\r\n        }\r\n\r\n        var enterCallback = GetValue(config, 'enter', undefined);\r\n        if (enterCallback) {\r\n            this['enter_' + name] = enterCallback;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    addStates(states) {\r\n        for (var name in states) {\r\n            this.addState(name, states[name]);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    update(time, delta, key) {\r\n        if (key === undefined) {\r\n            key = 'update';\r\n        }\r\n        var fn = this[key + '_' + this.state];\r\n        if (fn) {\r\n            fn.call(this, time, delta);\r\n        }\r\n    }\r\n\r\n    preupdate(time, delta) {\r\n        this.update(time, delta, 'preupdate');\r\n    }\r\n\r\n    postupdate(time, delta) {\r\n        this.update(time, delta, 'postupdate');\r\n    }\r\n}\r\n\r\nObject.assign(\r\n    FSM.prototype,\r\n    EventEmitterMethods\r\n);\r\n\r\nexport default FSM;"]},"metadata":{},"sourceType":"module"}