{"ast":null,"code":"import MaskToGameObject from '../../utils/mask/MaskToGameObject.js';\nconst Intersects = Phaser.Geom.Intersects.RectangleToRectangle;\nconst Overlaps = Phaser.Geom.Rectangle.Overlaps;\n\nvar MaskChildren = function (parent, mask, children) {\n  if (!mask) {\n    return;\n  }\n\n  if (children === undefined) {\n    children = parent.getAllChildren();\n  }\n\n  var parentBounds = parent.getBounds();\n  var maskGameObject = MaskToGameObject(mask);\n  var child, childBounds, visiblePointsNumber;\n\n  for (var i = 0, cnt = children.length; i < cnt; i++) {\n    child = children[i];\n\n    if (child.hasOwnProperty('isRexContainerLite')) {\n      continue;\n    }\n\n    if (child === maskGameObject) {\n      continue;\n    }\n\n    if (child.getBounds) {\n      childBounds = child.getBounds(childBounds);\n      visiblePointsNumber = containsPoints(parentBounds, childBounds);\n\n      switch (visiblePointsNumber) {\n        case 4:\n          // 4 points are all inside visible window, set visible\n          showAll(parent, child, mask);\n          break;\n\n        case 0:\n          // No point is inside visible window\n          // Parent intersects with child, or parent is inside child, set visible, and apply mask\n          if (Intersects(parentBounds, childBounds) || Overlaps(parentBounds, childBounds)) {\n            showSome(parent, child, mask);\n          } else {\n            // Set invisible\n            showNone(parent, child, mask);\n          }\n\n          break;\n\n        default:\n          // Part of points are inside visible window, set visible, and apply mask\n          showSome(parent, child, mask);\n          break;\n      }\n    } else {\n      showSome(parent, child, mask);\n    }\n  }\n};\n\nvar containsPoints = function (rectA, rectB) {\n  var result = 0;\n  var top = rectB.top,\n      bottom = rectB.bottom,\n      left = rectB.left,\n      right = rectB.right;\n  result += rectA.contains(left, top) ? 1 : 0;\n  result += rectA.contains(left, bottom) ? 1 : 0;\n  result += rectA.contains(right, top) ? 1 : 0;\n  result += rectA.contains(right, bottom) ? 1 : 0;\n  return result;\n};\n\nvar showAll = function (parent, child, mask) {\n  parent.setChildLocalVisible(child, true);\n\n  if (child.clearMask) {\n    child.clearMask();\n  }\n};\n\nvar showSome = function (parent, child, mask) {\n  parent.setChildLocalVisible(child, true);\n\n  if (child.setMask) {\n    child.setMask(mask);\n  }\n};\n\nvar showNone = function (parent, child, mask) {\n  parent.setChildLocalVisible(child, false);\n\n  if (child.clearMask) {\n    child.clearMask();\n  }\n};\n\nexport default MaskChildren;","map":{"version":3,"sources":["/home/jon/code/Projects/Soulys/frontend/node_modules/phaser3-rex-plugins/plugins/gameobjects/containerlite/MaskChildren.js"],"names":["MaskToGameObject","Intersects","Phaser","Geom","RectangleToRectangle","Overlaps","Rectangle","MaskChildren","parent","mask","children","undefined","getAllChildren","parentBounds","getBounds","maskGameObject","child","childBounds","visiblePointsNumber","i","cnt","length","hasOwnProperty","containsPoints","showAll","showSome","showNone","rectA","rectB","result","top","bottom","left","right","contains","setChildLocalVisible","clearMask","setMask"],"mappings":"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","sourcesContent":["import MaskToGameObject from '../../utils/mask/MaskToGameObject.js';\r\n\r\nconst Intersects = Phaser.Geom.Intersects.RectangleToRectangle;\r\nconst Overlaps = Phaser.Geom.Rectangle.Overlaps;\r\n\r\nvar MaskChildren = function (parent, mask, children) {\r\n    if (!mask) {\r\n        return;\r\n    }\r\n\r\n    if (children === undefined) {\r\n        children = parent.getAllChildren();\r\n    }\r\n\r\n    var parentBounds = parent.getBounds();\r\n    var maskGameObject = MaskToGameObject(mask);\r\n\r\n    var child, childBounds, visiblePointsNumber;\r\n    for (var i = 0, cnt = children.length; i < cnt; i++) {\r\n        child = children[i];\r\n        if (child.hasOwnProperty('isRexContainerLite')) {\r\n            continue;\r\n        }\r\n        if (child === maskGameObject) {\r\n            continue;\r\n        }\r\n\r\n        if (child.getBounds) {\r\n            childBounds = child.getBounds(childBounds);\r\n            visiblePointsNumber = containsPoints(parentBounds, childBounds);\r\n            switch (visiblePointsNumber) {\r\n                case 4: // 4 points are all inside visible window, set visible\r\n                    showAll(parent, child, mask);\r\n                    break;\r\n                case 0: // No point is inside visible window\r\n                    // Parent intersects with child, or parent is inside child, set visible, and apply mask\r\n                    if (Intersects(parentBounds, childBounds) || Overlaps(parentBounds, childBounds)) {\r\n                        showSome(parent, child, mask);\r\n                    } else { // Set invisible\r\n                        showNone(parent, child, mask);\r\n                    }\r\n                    break;\r\n                default: // Part of points are inside visible window, set visible, and apply mask\r\n                    showSome(parent, child, mask);\r\n                    break;\r\n            }\r\n        } else {\r\n            showSome(parent, child, mask);\r\n        }\r\n    }\r\n}\r\n\r\nvar containsPoints = function (rectA, rectB) {\r\n    var result = 0;\r\n    var top = rectB.top,\r\n        bottom = rectB.bottom,\r\n        left = rectB.left,\r\n        right = rectB.right;\r\n    result += rectA.contains(left, top) ? 1 : 0;\r\n    result += rectA.contains(left, bottom) ? 1 : 0;\r\n    result += rectA.contains(right, top) ? 1 : 0;\r\n    result += rectA.contains(right, bottom) ? 1 : 0;\r\n    return result;\r\n};\r\n\r\nvar showAll = function (parent, child, mask) {\r\n    parent.setChildLocalVisible(child, true);\r\n    if (child.clearMask) {\r\n        child.clearMask();\r\n    }\r\n}\r\n\r\nvar showSome = function (parent, child, mask) {\r\n    parent.setChildLocalVisible(child, true);\r\n    if (child.setMask) {\r\n        child.setMask(mask);\r\n    }\r\n}\r\n\r\nvar showNone = function (parent, child, mask) {\r\n    parent.setChildLocalVisible(child, false);\r\n    if (child.clearMask) {\r\n        child.clearMask();\r\n    }\r\n}\r\n\r\nexport default MaskChildren;"]},"metadata":{},"sourceType":"module"}