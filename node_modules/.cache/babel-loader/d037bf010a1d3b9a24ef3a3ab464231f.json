{"ast":null,"code":"import EventEmitterMethods from '../../utils/eventemitter/EventEmitterMethods.js';\nimport GetSceneObject from '../../utils/system/GetSceneObject.js';\nconst GetFastValue = Phaser.Utils.Objects.GetFastValue;\nconst GetValue = Phaser.Utils.Objects.GetValue;\n\nclass TextTyping {\n  constructor(gameObject, config) {\n    this.gameObject = gameObject;\n    this.scene = GetSceneObject(gameObject);\n    this.setEventEmitter(GetValue(config, 'eventEmitter', undefined));\n    this.timer = null;\n    this.resetFromJSON(config);\n    this.boot();\n  }\n  /**\r\n   * Reset status by JSON object\r\n   * @param {object} o JSON object\r\n   * @returns {object} this object\r\n   */\n\n\n  resetFromJSON(o) {\n    this.setTypeMode(GetValue(o, 'typeMode', 0));\n    this.setTypeSpeed(GetValue(o, 'speed', 333));\n    this.setTextCallback = GetFastValue(o, 'setTextCallback', null);\n    this.setTextCallbackScope = GetFastValue(o, 'setTextCallbackScope', null);\n    this.typingIdx = GetFastValue(o, 'typingIdx', 0);\n    this.text = transferText(GetFastValue(o, 'text', ''));\n    this.textLen = GetFastValue(o, 'textLen', 0);\n    this.insertIdx = GetFastValue(o, 'insertIdx', null);\n    var elapsed = GetFastValue(o, 'elapsed', null);\n\n    if (elapsed !== null) {\n      this.start(undefined, undefined, this.typingIdx, elapsed);\n    }\n\n    return this;\n  }\n  /**\r\n   * Return status in JSON object\r\n   * @returns JSON object\r\n   */\n\n\n  toJSON() {\n    var elapsed;\n    var timer = this.getTimer();\n\n    if (timer) {\n      elapsed = timer.elapsed;\n    } else {\n      elapsed = null;\n    }\n\n    return {\n      typeMode: this.typeMode,\n      speed: this.speed,\n      setTextCallback: this.setTextCallback,\n      setTextCallbackScope: this.setTextCallbackScope,\n      typingIdx: this.typingIdx,\n      text: this.text,\n      textLen: this.textLen,\n      insertIdx: this.insertIdx,\n      elapsed: elapsed\n    };\n  }\n\n  boot() {\n    if (this.gameObject.once) {\n      // oops, bob object does not have event emitter\n      this.gameObject.on('destroy', this.destroy, this);\n    }\n\n    return this;\n  }\n\n  shutdown() {\n    this.destroyEventEmitter();\n    this.freeTimer();\n    this.gameObject = undefined;\n    this.scene = undefined;\n    return this;\n  }\n\n  destroy() {\n    this.shutdown();\n    return this;\n  }\n\n  setTypeMode(m) {\n    if (typeof m === 'string') {\n      m = TYPEMODE[m];\n    }\n\n    this.typeMode = m;\n    return this;\n  }\n\n  setTypeSpeed(speed) {\n    this.speed = speed;\n    return this;\n  }\n\n  get isTyping() {\n    return this.getTimer() !== null;\n  }\n\n  get isLastChar() {\n    return this.typingIdx === this.textLen;\n  }\n\n  start(text, speed, startIdx, timerStartAt) {\n    if (text !== undefined) {\n      this.setTypingContent(text);\n    }\n\n    if (speed !== undefined) {\n      this.speed = speed;\n    }\n\n    if (startIdx === undefined) {\n      startIdx = 0;\n    }\n\n    this.typingIdx = startIdx + 1;\n\n    if (this.speed === 0) {\n      this.stop(true);\n    } else {\n      this.startTimer(timerStartAt);\n    }\n\n    return this;\n  }\n\n  appendText(text) {\n    var newText = this.text.concat(transferText(text));\n\n    if (this.isTyping) {\n      this.setTypingContent(newText);\n    } else {\n      this.start(newText, undefined, this.textLen);\n    }\n\n    return this;\n  }\n\n  stop(showAllText) {\n    var timer = this.getTimer();\n\n    if (timer) {\n      this.freeTimer();\n    }\n\n    if (showAllText) {\n      this.typingIdx = this.textLen;\n      this.setText(this.text);\n      this.emit('type');\n      this.emit('complete', this, this.gameObject);\n    }\n\n    return this;\n  }\n\n  pause() {\n    var timer = this.getTimer();\n\n    if (timer) {\n      timer.paused = true;\n    }\n\n    return this;\n  }\n\n  resume() {\n    var timer = this.getTimer();\n\n    if (timer) {\n      timer.paused = false;\n    }\n\n    return this;\n  }\n\n  setTypingContent(text) {\n    this.text = transferText(text);\n    this.textLen = this.getTextLength(this.text);\n    return this;\n  }\n\n  onTyping() {\n    var newText = this.getTypingString(this.text, this.typingIdx, this.textLen, this.typeMode);\n    this.setText(newText);\n    this.emit('type');\n\n    if (this.isLastChar) {\n      this.freeTimer();\n      this.emit('complete', this, this.gameObject);\n    } else {\n      this.timer.delay = this.speed; // delay of next typing            \n\n      this.typingIdx++;\n    }\n  }\n\n  getTypingString(text, typeIdx, textLen, typeMode) {\n    var result;\n\n    if (typeMode === 0) {\n      //left-to-right\n      var startIdx = 0;\n      var endIdx = typeIdx;\n      this.insertIdx = endIdx;\n      result = this.getSubString(text, startIdx, endIdx);\n    } else if (typeMode === 1) {\n      //right-to-left\n      var endIdx = textLen;\n      var startIdx = endIdx - typeIdx;\n      this.insertIdx = 0;\n      result = this.getSubString(text, startIdx, endIdx);\n    } else if (typeMode === 2) {\n      //middle-to-sides\n      var midIdx = textLen / 2;\n      var startIdx = Math.floor(midIdx - typeIdx / 2);\n      var endIdx = startIdx + typeIdx;\n      this.insertIdx = typeIdx % 2 ? typeIdx : 0;\n      result = this.getSubString(text, startIdx, endIdx);\n    } else if (typeMode === 3) {\n      //sides-to-middle\n      var lowerLen = Math.floor(typeIdx / 2);\n      var lowerResult;\n\n      if (lowerLen > 0) {\n        var endIdx = textLen;\n        var startIdx = endIdx - lowerLen;\n        lowerResult = this.getSubString(text, startIdx, endIdx);\n      } else {\n        lowerResult = \"\";\n      }\n\n      var upperLen = typeIdx - lowerLen;\n      var upperResult;\n\n      if (upperLen > 0) {\n        var startIdx = 0;\n        var endIdx = startIdx + upperLen;\n        this.insertIdx = endIdx;\n        upperResult = this.getSubString(text, startIdx, endIdx);\n      } else {\n        upperResult = \"\";\n        this.insertIdx = 0;\n      }\n\n      result = upperResult + lowerResult;\n    }\n\n    return result;\n  }\n\n  startTimer(timerStartAt) {\n    if (this.timer) {\n      this.freeTimer();\n    }\n\n    var delay, startAt;\n\n    if (timerStartAt === undefined) {\n      delay = 0;\n      startAt = 0;\n    } else {\n      delay = this.speed;\n      startAt = timerStartAt;\n    }\n\n    this.timer = this.scene.time.addEvent({\n      delay: 0,\n      startAt: startAt,\n      loop: true,\n      callback: this.onTyping,\n      callbackScope: this\n    });\n    return this;\n  }\n\n  getTimer() {\n    return this.timer;\n  }\n\n  freeTimer() {\n    if (this.timer) {\n      this.timer.remove();\n      this.timer = null;\n    }\n\n    return this;\n  }\n\n  setText(text) {\n    if (this.setTextCallback) {\n      if (this.setTextCallbackScope) {\n        text = this.setTextCallback.call(this.setTextCallbackScope, text, this.isLastChar, this.insertIdx);\n      } else {\n        text = this.setTextCallback(text, this.isLastChar, this.insertIdx);\n      }\n    }\n\n    this.gameObject.setText(text);\n  }\n\n  getTextLength(text) {\n    var gameObject = this.gameObject;\n    var len;\n\n    if (gameObject.getPlainText) {\n      len = gameObject.getPlainText(text).length;\n    } else {\n      len = text.length;\n    }\n\n    return len;\n  }\n\n  getSubString(text, startIdx, endIdx) {\n    var gameObject = this.gameObject;\n    var result;\n\n    if (gameObject.getSubString) {\n      result = gameObject.getSubString(text, startIdx, endIdx);\n    } else {\n      result = text.slice(startIdx, endIdx);\n    }\n\n    return result;\n  }\n\n}\n\nObject.assign(TextTyping.prototype, EventEmitterMethods);\n\nvar transferText = function (text) {\n  if (Array.isArray(text)) {\n    text = text.join('\\n');\n  } else if (typeof text === 'number') {\n    text = text.toString();\n  }\n\n  return text;\n};\n/** @private */\n\n\nconst TYPEMODE = {\n  'left-to-right': 0,\n  'right-to-left': 1,\n  'middle-to-sides': 2,\n  'sides-to-middle': 3\n};\nexport default TextTyping;","map":{"version":3,"sources":["/home/jon/code/Projects/Soulys/frontend/node_modules/phaser3-rex-plugins/plugins/behaviors/texttyping/TextTyping.js"],"names":["EventEmitterMethods","GetSceneObject","GetFastValue","Phaser","Utils","Objects","GetValue","TextTyping","constructor","gameObject","config","scene","setEventEmitter","undefined","timer","resetFromJSON","boot","o","setTypeMode","setTypeSpeed","setTextCallback","setTextCallbackScope","typingIdx","text","transferText","textLen","insertIdx","elapsed","start","toJSON","getTimer","typeMode","speed","once","on","destroy","shutdown","destroyEventEmitter","freeTimer","m","TYPEMODE","isTyping","isLastChar","startIdx","timerStartAt","setTypingContent","stop","startTimer","appendText","newText","concat","showAllText","setText","emit","pause","paused","resume","getTextLength","onTyping","getTypingString","delay","typeIdx","result","endIdx","getSubString","midIdx","Math","floor","lowerLen","lowerResult","upperLen","upperResult","startAt","time","addEvent","loop","callback","callbackScope","remove","call","len","getPlainText","length","slice","Object","assign","prototype","Array","isArray","join","toString"],"mappings":"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","sourcesContent":["import EventEmitterMethods from '../../utils/eventemitter/EventEmitterMethods.js';\r\nimport GetSceneObject from '../../utils/system/GetSceneObject.js';\r\n\r\nconst GetFastValue = Phaser.Utils.Objects.GetFastValue;\r\nconst GetValue = Phaser.Utils.Objects.GetValue;\r\n\r\nclass TextTyping {\r\n    constructor(gameObject, config) {\r\n        this.gameObject = gameObject;\r\n        this.scene = GetSceneObject(gameObject);        \r\n        this.setEventEmitter(GetValue(config, 'eventEmitter', undefined));\r\n        \r\n        this.timer = null;\r\n        this.resetFromJSON(config);\r\n        this.boot();\r\n    }\r\n\r\n    /**\r\n     * Reset status by JSON object\r\n     * @param {object} o JSON object\r\n     * @returns {object} this object\r\n     */\r\n    resetFromJSON(o) {\r\n        this.setTypeMode(GetValue(o, 'typeMode', 0));\r\n        this.setTypeSpeed(GetValue(o, 'speed', 333));\r\n        this.setTextCallback = GetFastValue(o, 'setTextCallback', null);\r\n        this.setTextCallbackScope = GetFastValue(o, 'setTextCallbackScope', null);\r\n\r\n        this.typingIdx = GetFastValue(o, 'typingIdx', 0);\r\n        this.text = transferText(GetFastValue(o, 'text', ''));\r\n        this.textLen = GetFastValue(o, 'textLen', 0);\r\n        this.insertIdx = GetFastValue(o, 'insertIdx', null);\r\n\r\n        var elapsed = GetFastValue(o, 'elapsed', null);\r\n        if (elapsed !== null) {\r\n            this.start(undefined, undefined, this.typingIdx, elapsed);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Return status in JSON object\r\n     * @returns JSON object\r\n     */\r\n    toJSON() {\r\n        var elapsed;\r\n        var timer = this.getTimer();\r\n        if (timer) {\r\n            elapsed = timer.elapsed;\r\n        } else {\r\n            elapsed = null;\r\n        }\r\n\r\n        return {\r\n            typeMode: this.typeMode,\r\n            speed: this.speed,\r\n            setTextCallback: this.setTextCallback,\r\n            setTextCallbackScope: this.setTextCallbackScope,\r\n\r\n            typingIdx: this.typingIdx,\r\n            text: this.text,\r\n            textLen: this.textLen,\r\n            insertIdx: this.insertIdx,\r\n            elapsed: elapsed\r\n        };\r\n    }\r\n\r\n    boot() {\r\n        if (this.gameObject.once) { // oops, bob object does not have event emitter\r\n            this.gameObject.on('destroy', this.destroy, this);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    shutdown() {\r\n        this.destroyEventEmitter();\r\n        this.freeTimer();\r\n        this.gameObject = undefined;\r\n        this.scene = undefined;\r\n        return this;\r\n    }\r\n\r\n    destroy() {\r\n        this.shutdown();\r\n        return this;\r\n    }\r\n\r\n    setTypeMode(m) {\r\n        if (typeof (m) === 'string') {\r\n            m = TYPEMODE[m];\r\n        }\r\n        this.typeMode = m;\r\n        return this;\r\n    }\r\n\r\n    setTypeSpeed(speed) {\r\n        this.speed = speed;\r\n        return this;\r\n    }\r\n\r\n    get isTyping() {\r\n        return (this.getTimer() !== null);\r\n    }\r\n\r\n    get isLastChar() {\r\n        return (this.typingIdx === this.textLen);\r\n    }\r\n\r\n    start(text, speed, startIdx, timerStartAt) {\r\n        if (text !== undefined) {\r\n            this.setTypingContent(text);\r\n        }\r\n        if (speed !== undefined) {\r\n            this.speed = speed;\r\n        }\r\n        if (startIdx === undefined) {\r\n            startIdx = 0;\r\n        }\r\n\r\n        this.typingIdx = startIdx + 1;\r\n        if (this.speed === 0) {\r\n            this.stop(true);\r\n        } else {\r\n            this.startTimer(timerStartAt);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    appendText(text) {\r\n        var newText = this.text.concat(transferText(text));\r\n        if (this.isTyping) {\r\n            this.setTypingContent(newText);\r\n        } else {\r\n            this.start(newText, undefined, this.textLen);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    stop(showAllText) {\r\n        var timer = this.getTimer();\r\n        if (timer) {\r\n            this.freeTimer();\r\n        }\r\n        if (showAllText) {\r\n            this.typingIdx = this.textLen;\r\n            this.setText(this.text);\r\n            this.emit('type');\r\n            this.emit('complete', this, this.gameObject);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    pause() {\r\n        var timer = this.getTimer();\r\n        if (timer) {\r\n            timer.paused = true;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    resume() {\r\n        var timer = this.getTimer();\r\n        if (timer) {\r\n            timer.paused = false;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    setTypingContent(text) {\r\n        this.text = transferText(text);\r\n        this.textLen = this.getTextLength(this.text);\r\n        return this;\r\n    }\r\n\r\n    onTyping() {\r\n        var newText = this.getTypingString(this.text, this.typingIdx, this.textLen, this.typeMode);\r\n        this.setText(newText);\r\n        this.emit('type');\r\n\r\n        if (this.isLastChar) {\r\n            this.freeTimer();\r\n            this.emit('complete', this, this.gameObject);\r\n        } else {\r\n            this.timer.delay = this.speed; // delay of next typing            \r\n            this.typingIdx++;\r\n        }\r\n    }\r\n\r\n    getTypingString(text, typeIdx, textLen, typeMode) {\r\n        var result;\r\n        if (typeMode === 0) { //left-to-right\r\n            var startIdx = 0;\r\n            var endIdx = typeIdx;\r\n            this.insertIdx = endIdx;\r\n            result = this.getSubString(text, startIdx, endIdx);\r\n\r\n        } else if (typeMode === 1) { //right-to-left\r\n            var endIdx = textLen;\r\n            var startIdx = endIdx - typeIdx;\r\n            this.insertIdx = 0;\r\n            result = this.getSubString(text, startIdx, endIdx);\r\n\r\n        } else if (typeMode === 2) { //middle-to-sides\r\n            var midIdx = textLen / 2;\r\n            var startIdx = Math.floor(midIdx - (typeIdx / 2));\r\n            var endIdx = startIdx + typeIdx;\r\n            this.insertIdx = (typeIdx % 2) ? typeIdx : 0;\r\n            result = this.getSubString(text, startIdx, endIdx);\r\n\r\n        } else if (typeMode === 3) { //sides-to-middle\r\n            var lowerLen = Math.floor(typeIdx / 2);\r\n            var lowerResult;\r\n            if (lowerLen > 0) {\r\n                var endIdx = textLen;\r\n                var startIdx = endIdx - lowerLen;\r\n                lowerResult = this.getSubString(text, startIdx, endIdx);\r\n            } else {\r\n                lowerResult = \"\";\r\n            }\r\n\r\n            var upperLen = typeIdx - lowerLen;\r\n            var upperResult;\r\n            if (upperLen > 0) {\r\n                var startIdx = 0;\r\n                var endIdx = startIdx + upperLen;\r\n                this.insertIdx = endIdx;\r\n                upperResult = this.getSubString(text, startIdx, endIdx);\r\n            } else {\r\n                upperResult = \"\";\r\n                this.insertIdx = 0;\r\n            }\r\n            result = upperResult + lowerResult;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    startTimer(timerStartAt) {\r\n        if (this.timer) {\r\n            this.freeTimer();\r\n        }\r\n        var delay, startAt;\r\n        if (timerStartAt === undefined) {\r\n            delay = 0;\r\n            startAt = 0;\r\n        } else {\r\n            delay = this.speed;\r\n            startAt = timerStartAt;\r\n        }\r\n\r\n        this.timer = this.scene.time.addEvent({\r\n            delay: 0,\r\n            startAt: startAt,\r\n            loop: true,\r\n            callback: this.onTyping,\r\n            callbackScope: this\r\n        });\r\n        return this;\r\n    }\r\n\r\n    getTimer() {\r\n        return this.timer;\r\n    }\r\n\r\n    freeTimer() {\r\n        if (this.timer) {\r\n            this.timer.remove();\r\n            this.timer = null;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    setText(text) {\r\n        if (this.setTextCallback) {\r\n            if (this.setTextCallbackScope) {\r\n                text = this.setTextCallback.call(this.setTextCallbackScope, text, this.isLastChar, this.insertIdx);\r\n            } else {\r\n                text = this.setTextCallback(text, this.isLastChar, this.insertIdx);\r\n            }\r\n        }\r\n        this.gameObject.setText(text);\r\n    }\r\n\r\n    getTextLength(text) {\r\n        var gameObject = this.gameObject;\r\n        var len;\r\n        if (gameObject.getPlainText) {\r\n            len = gameObject.getPlainText(text).length;\r\n        } else {\r\n            len = text.length;\r\n        }\r\n\r\n        return len;\r\n    }\r\n\r\n    getSubString(text, startIdx, endIdx) {\r\n        var gameObject = this.gameObject;\r\n        var result;\r\n        if (gameObject.getSubString) {\r\n            result = gameObject.getSubString(text, startIdx, endIdx);\r\n        } else {\r\n            result = text.slice(startIdx, endIdx);\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\nObject.assign(\r\n    TextTyping.prototype,\r\n    EventEmitterMethods\r\n);\r\n\r\nvar transferText = function (text) {\r\n    if (Array.isArray(text)) {\r\n        text = text.join('\\n');\r\n    } else if (typeof (text) === 'number') {\r\n        text = text.toString();\r\n    }\r\n    return text;\r\n}\r\n\r\n/** @private */\r\nconst TYPEMODE = {\r\n    'left-to-right': 0,\r\n    'right-to-left': 1,\r\n    'middle-to-sides': 2,\r\n    'sides-to-middle': 3\r\n};\r\n\r\n\r\nexport default TextTyping;"]},"metadata":{},"sourceType":"module"}