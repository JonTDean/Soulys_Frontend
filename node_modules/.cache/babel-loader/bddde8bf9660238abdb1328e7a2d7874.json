{"ast":null,"code":"import GetSceneObject from '../../utils/system/GetSceneObject.js';\nimport CreateInputTextFromText from './CreateInputText.js';\nimport IsFunction from '../../utils/object/IsFunction.js';\nconst GetValue = Phaser.Utils.Objects.GetValue;\n\nclass TextEdit {\n  constructor(gameObject) {\n    this.gameObject = gameObject;\n    this.scene = GetSceneObject(gameObject);\n    this.inputText = undefined;\n    this.onClose = undefined;\n    this.delayCall = undefined;\n    this.boot();\n  }\n\n  boot() {\n    this.gameObject.on('destroy', this.destroy, this);\n    return this;\n  }\n\n  shutdown() {\n    this.close();\n    this.gameObject = undefined;\n    this.scene = undefined;\n\n    if (globLastOpenedEditor === this) {\n      globLastOpenedEditor = undefined;\n    }\n\n    return this;\n  }\n\n  destroy() {\n    this.shutdown();\n    return this;\n  }\n\n  open(config, onCloseCallback) {\n    if (globLastOpenedEditor !== undefined) {\n      globLastOpenedEditor.close();\n    }\n\n    globLastOpenedEditor = this;\n\n    if (IsFunction(config)) {\n      onCloseCallback = config;\n      config = undefined;\n    }\n\n    if (onCloseCallback === undefined) {\n      onCloseCallback = GetValue(config, 'onClose', undefined);\n    }\n\n    var customOnTextChanged = GetValue(config, 'onTextChanged', undefined);\n    this.inputText = CreateInputTextFromText(this.gameObject, config).on('textchange', function (inputText) {\n      var text = inputText.text;\n\n      if (customOnTextChanged) {\n        // Custom on-text-changed callback\n        customOnTextChanged(this.gameObject, text);\n      } else {\n        // Default on-text-changed callback\n        this.gameObject.text = text;\n      }\n    }, this).setFocus();\n    this.gameObject.setVisible(false); // Set parent text invisible\n    // Attach close event\n\n    this.onClose = onCloseCallback;\n    this.scene.input.keyboard.once('keydown-ENTER', this.close, this); // Attach pointerdown (outside of input-text) event, at next tick\n\n    this.delayCall = this.scene.time.delayedCall(0, function () {\n      this.scene.input.once('pointerdown', this.close, this);\n    }, [], this);\n    return this;\n  }\n\n  close() {\n    globLastOpenedEditor = undefined;\n\n    if (!this.inputText) {\n      return this;\n    }\n\n    this.gameObject.setVisible(true); // Set parent text visible\n\n    this.inputText.destroy();\n    this.inputText = undefined;\n\n    if (this.delayCall) {\n      this.delayCall.remove();\n      this.delayCall = undefined;\n    } // Remove close event\n\n\n    this.scene.input.keyboard.off('keydown-ENTER', this.close, this);\n    this.scene.input.off('pointerdown', this.close, this);\n\n    if (this.onClose) {\n      this.onClose(this.gameObject);\n    }\n\n    return this;\n  }\n\n  get isOpened() {\n    return this.inputText !== undefined;\n  }\n\n  get text() {\n    return this.isOpened ? this.inputText.text : this.gameObject.text;\n  }\n\n}\n\nvar globLastOpenedEditor = undefined;\nexport default TextEdit;","map":{"version":3,"sources":["/home/jon/code/Projects/Soulys/frontend/node_modules/phaser3-rex-plugins/plugins/behaviors/textedit/TextEdit.js"],"names":["GetSceneObject","CreateInputTextFromText","IsFunction","GetValue","Phaser","Utils","Objects","TextEdit","constructor","gameObject","scene","inputText","undefined","onClose","delayCall","boot","on","destroy","shutdown","close","globLastOpenedEditor","open","config","onCloseCallback","customOnTextChanged","text","setFocus","setVisible","input","keyboard","once","time","delayedCall","remove","off","isOpened"],"mappings":"AAAA,OAAOA,cAAP,MAA2B,sCAA3B;AACA,OAAOC,uBAAP,MAAoC,sBAApC;AACA,OAAOC,UAAP,MAAuB,kCAAvB;AAEA,MAAMC,QAAQ,GAAGC,MAAM,CAACC,KAAP,CAAaC,OAAb,CAAqBH,QAAtC;;AAEA,MAAMI,QAAN,CAAe;AACXC,EAAAA,WAAW,CAACC,UAAD,EAAa;AACpB,SAAKA,UAAL,GAAkBA,UAAlB;AACA,SAAKC,KAAL,GAAaV,cAAc,CAACS,UAAD,CAA3B;AAEA,SAAKE,SAAL,GAAiBC,SAAjB;AACA,SAAKC,OAAL,GAAeD,SAAf;AACA,SAAKE,SAAL,GAAiBF,SAAjB;AACA,SAAKG,IAAL;AACH;;AAEDA,EAAAA,IAAI,GAAG;AACH,SAAKN,UAAL,CAAgBO,EAAhB,CAAmB,SAAnB,EAA8B,KAAKC,OAAnC,EAA4C,IAA5C;AAEA,WAAO,IAAP;AACH;;AAEDC,EAAAA,QAAQ,GAAG;AACP,SAAKC,KAAL;AACA,SAAKV,UAAL,GAAkBG,SAAlB;AACA,SAAKF,KAAL,GAAaE,SAAb;;AACA,QAAIQ,oBAAoB,KAAK,IAA7B,EAAmC;AAC/BA,MAAAA,oBAAoB,GAAGR,SAAvB;AACH;;AACD,WAAO,IAAP;AACH;;AAEDK,EAAAA,OAAO,GAAG;AACN,SAAKC,QAAL;AACA,WAAO,IAAP;AACH;;AAEDG,EAAAA,IAAI,CAACC,MAAD,EAASC,eAAT,EAA0B;AAC1B,QAAIH,oBAAoB,KAAKR,SAA7B,EAAwC;AACpCQ,MAAAA,oBAAoB,CAACD,KAArB;AACH;;AAEDC,IAAAA,oBAAoB,GAAG,IAAvB;;AACA,QAAIlB,UAAU,CAACoB,MAAD,CAAd,EAAwB;AACpBC,MAAAA,eAAe,GAAGD,MAAlB;AACAA,MAAAA,MAAM,GAAGV,SAAT;AACH;;AACD,QAAIW,eAAe,KAAKX,SAAxB,EAAmC;AAC/BW,MAAAA,eAAe,GAAGpB,QAAQ,CAACmB,MAAD,EAAS,SAAT,EAAoBV,SAApB,CAA1B;AACH;;AAED,QAAIY,mBAAmB,GAAGrB,QAAQ,CAACmB,MAAD,EAAS,eAAT,EAA0BV,SAA1B,CAAlC;AAEA,SAAKD,SAAL,GAAiBV,uBAAuB,CAAC,KAAKQ,UAAN,EAAkBa,MAAlB,CAAvB,CACZN,EADY,CACT,YADS,EACK,UAAUL,SAAV,EAAqB;AACnC,UAAIc,IAAI,GAAGd,SAAS,CAACc,IAArB;;AACA,UAAID,mBAAJ,EAAyB;AAAE;AACvBA,QAAAA,mBAAmB,CAAC,KAAKf,UAAN,EAAkBgB,IAAlB,CAAnB;AACH,OAFD,MAEO;AAAE;AACL,aAAKhB,UAAL,CAAgBgB,IAAhB,GAAuBA,IAAvB;AACH;AACJ,KARY,EAQV,IARU,EASZC,QATY,EAAjB;AAUA,SAAKjB,UAAL,CAAgBkB,UAAhB,CAA2B,KAA3B,EA1B0B,CA0BS;AAEnC;;AACA,SAAKd,OAAL,GAAeU,eAAf;AACA,SAAKb,KAAL,CAAWkB,KAAX,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+B,eAA/B,EAAgD,KAAKX,KAArD,EAA4D,IAA5D,EA9B0B,CA+B1B;;AACA,SAAKL,SAAL,GAAiB,KAAKJ,KAAL,CAAWqB,IAAX,CAAgBC,WAAhB,CAA4B,CAA5B,EAA+B,YAAY;AACxD,WAAKtB,KAAL,CAAWkB,KAAX,CAAiBE,IAAjB,CAAsB,aAAtB,EAAqC,KAAKX,KAA1C,EAAiD,IAAjD;AACH,KAFgB,EAEd,EAFc,EAEV,IAFU,CAAjB;AAGA,WAAO,IAAP;AACH;;AAEDA,EAAAA,KAAK,GAAG;AACJC,IAAAA,oBAAoB,GAAGR,SAAvB;;AACA,QAAI,CAAC,KAAKD,SAAV,EAAqB;AACjB,aAAO,IAAP;AACH;;AAED,SAAKF,UAAL,CAAgBkB,UAAhB,CAA2B,IAA3B,EANI,CAM8B;;AAElC,SAAKhB,SAAL,CAAeM,OAAf;AACA,SAAKN,SAAL,GAAiBC,SAAjB;;AACA,QAAI,KAAKE,SAAT,EAAoB;AAChB,WAAKA,SAAL,CAAemB,MAAf;AACA,WAAKnB,SAAL,GAAiBF,SAAjB;AACH,KAbG,CAeJ;;;AACA,SAAKF,KAAL,CAAWkB,KAAX,CAAiBC,QAAjB,CAA0BK,GAA1B,CAA8B,eAA9B,EAA+C,KAAKf,KAApD,EAA2D,IAA3D;AACA,SAAKT,KAAL,CAAWkB,KAAX,CAAiBM,GAAjB,CAAqB,aAArB,EAAoC,KAAKf,KAAzC,EAAgD,IAAhD;;AAEA,QAAI,KAAKN,OAAT,EAAkB;AACd,WAAKA,OAAL,CAAa,KAAKJ,UAAlB;AACH;;AACD,WAAO,IAAP;AACH;;AAED,MAAI0B,QAAJ,GAAe;AACX,WAAQ,KAAKxB,SAAL,KAAmBC,SAA3B;AACH;;AAED,MAAIa,IAAJ,GAAW;AACP,WAAQ,KAAKU,QAAN,GAAkB,KAAKxB,SAAL,CAAec,IAAjC,GAAwC,KAAKhB,UAAL,CAAgBgB,IAA/D;AACH;;AArGU;;AAwGf,IAAIL,oBAAoB,GAAGR,SAA3B;AAEA,eAAeL,QAAf","sourcesContent":["import GetSceneObject from '../../utils/system/GetSceneObject.js';\r\nimport CreateInputTextFromText from './CreateInputText.js';\r\nimport IsFunction from '../../utils/object/IsFunction.js';\r\n\r\nconst GetValue = Phaser.Utils.Objects.GetValue;\r\n\r\nclass TextEdit {\r\n    constructor(gameObject) {\r\n        this.gameObject = gameObject;\r\n        this.scene = GetSceneObject(gameObject);\r\n\r\n        this.inputText = undefined;\r\n        this.onClose = undefined;\r\n        this.delayCall = undefined;\r\n        this.boot();\r\n    }\r\n\r\n    boot() {\r\n        this.gameObject.on('destroy', this.destroy, this);\r\n\r\n        return this;\r\n    }\r\n\r\n    shutdown() {\r\n        this.close();\r\n        this.gameObject = undefined;\r\n        this.scene = undefined;\r\n        if (globLastOpenedEditor === this) {\r\n            globLastOpenedEditor = undefined;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    destroy() {\r\n        this.shutdown();\r\n        return this;\r\n    }\r\n\r\n    open(config, onCloseCallback) {\r\n        if (globLastOpenedEditor !== undefined) {\r\n            globLastOpenedEditor.close();\r\n        }\r\n\r\n        globLastOpenedEditor = this;\r\n        if (IsFunction(config)) {\r\n            onCloseCallback = config;\r\n            config = undefined;\r\n        }\r\n        if (onCloseCallback === undefined) {\r\n            onCloseCallback = GetValue(config, 'onClose', undefined);\r\n        }\r\n\r\n        var customOnTextChanged = GetValue(config, 'onTextChanged', undefined);\r\n\r\n        this.inputText = CreateInputTextFromText(this.gameObject, config)\r\n            .on('textchange', function (inputText) {\r\n                var text = inputText.text;\r\n                if (customOnTextChanged) { // Custom on-text-changed callback\r\n                    customOnTextChanged(this.gameObject, text);\r\n                } else { // Default on-text-changed callback\r\n                    this.gameObject.text = text;\r\n                }\r\n            }, this)\r\n            .setFocus();\r\n        this.gameObject.setVisible(false); // Set parent text invisible\r\n\r\n        // Attach close event\r\n        this.onClose = onCloseCallback;\r\n        this.scene.input.keyboard.once('keydown-ENTER', this.close, this);\r\n        // Attach pointerdown (outside of input-text) event, at next tick\r\n        this.delayCall = this.scene.time.delayedCall(0, function () {\r\n            this.scene.input.once('pointerdown', this.close, this);\r\n        }, [], this);\r\n        return this;\r\n    }\r\n\r\n    close() {\r\n        globLastOpenedEditor = undefined;\r\n        if (!this.inputText) {\r\n            return this;\r\n        }\r\n\r\n        this.gameObject.setVisible(true); // Set parent text visible\r\n\r\n        this.inputText.destroy();\r\n        this.inputText = undefined;\r\n        if (this.delayCall) {\r\n            this.delayCall.remove();\r\n            this.delayCall = undefined;\r\n        }\r\n\r\n        // Remove close event\r\n        this.scene.input.keyboard.off('keydown-ENTER', this.close, this);\r\n        this.scene.input.off('pointerdown', this.close, this);\r\n\r\n        if (this.onClose) {\r\n            this.onClose(this.gameObject);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    get isOpened() {\r\n        return (this.inputText !== undefined);\r\n    }\r\n\r\n    get text() {\r\n        return (this.isOpened) ? this.inputText.text : this.gameObject.text;\r\n    }\r\n}\r\n\r\nvar globLastOpenedEditor = undefined;\r\n\r\nexport default TextEdit;"]},"metadata":{},"sourceType":"module"}