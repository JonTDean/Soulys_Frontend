{"ast":null,"code":"export default {\n  draw(startX, startY, boxWidth, boxHeight) {\n    var penManager = this.penManager;\n    this.hitAreaManager.clear();\n    var context = this.context;\n    context.save(); // this.clear();\n\n    this.drawBackground(this.defatultStyle.backgroundColor); // draw lines\n\n    var defatultStyle = this.defatultStyle;\n    startX += this.startXOffset;\n    startY += this.startYOffset;\n    var halign = defatultStyle.halign,\n        valign = defatultStyle.valign;\n    var lineWidth,\n        lineHeight = defatultStyle.lineHeight;\n    var lines = penManager.lines;\n    var totalLinesNum = lines.length,\n        maxLines = defatultStyle.maxLines;\n    var drawLinesNum, drawLineStartIdx, drawLineEndIdx;\n\n    if (maxLines > 0 && totalLinesNum > maxLines) {\n      drawLinesNum = maxLines;\n\n      if (valign === 'center') {\n        // center\n        drawLineStartIdx = Math.floor((totalLinesNum - drawLinesNum) / 2);\n      } else if (valign === 'bottom') {\n        // bottom\n        drawLineStartIdx = totalLinesNum - drawLinesNum;\n      } else {\n        drawLineStartIdx = 0;\n      }\n    } else {\n      drawLinesNum = totalLinesNum;\n      drawLineStartIdx = 0;\n    }\n\n    drawLineEndIdx = drawLineStartIdx + drawLinesNum;\n    var offsetX, offsetY;\n\n    if (valign === 'center') {\n      // center\n      offsetY = Math.max((boxHeight - drawLinesNum * lineHeight) / 2, 0);\n    } else if (valign === 'bottom') {\n      // bottom\n      offsetY = Math.max(boxHeight - drawLinesNum * lineHeight - 2, 0);\n    } else {\n      offsetY = 0;\n    }\n\n    offsetY += startY;\n\n    for (var lineIdx = drawLineStartIdx; lineIdx < drawLineEndIdx; lineIdx++) {\n      lineWidth = penManager.getLineWidth(lineIdx);\n\n      if (lineWidth === 0) {\n        continue;\n      }\n\n      if (halign === 'center') {\n        // center\n        offsetX = (boxWidth - lineWidth) / 2;\n      } else if (halign === 'right') {\n        // right\n        offsetX = boxWidth - lineWidth;\n      } else {\n        offsetX = 0;\n      }\n\n      offsetX += startX;\n      var pens = lines[lineIdx];\n\n      for (var penIdx = 0, pensLen = pens.length; penIdx < pensLen; penIdx++) {\n        this.drawPen(pens[penIdx], offsetX, offsetY);\n      }\n    }\n\n    context.restore();\n  },\n\n  drawPen(pen, offsetX, offsetY) {\n    offsetX += pen.x;\n    offsetY += pen.y;\n    var canvas = this.canvas;\n    var context = this.context;\n    context.save();\n    var curStyle = this.parser.propToContextStyle(this.defatultStyle, pen.prop);\n    curStyle.buildFont();\n    curStyle.syncFont(canvas, context);\n    curStyle.syncStyle(canvas, context); // Underline\n\n    if (curStyle.underlineThickness > 0 && pen.width > 0) {\n      this.drawUnderline(offsetX, offsetY, pen.width, curStyle);\n    } // Text\n\n\n    if (pen.isTextPen) {\n      this.drawText(offsetX, offsetY, pen.text, curStyle);\n    } // Image\n\n\n    if (pen.isImagePen) {\n      this.drawImage(offsetX, offsetY, pen.prop.img, curStyle);\n    }\n\n    context.restore();\n\n    if (pen.hasAreaMarker && pen.width > 0) {\n      this.hitAreaManager.add(pen.prop.area, // key\n      offsetX, // x\n      offsetY - this.startYOffset, // y\n      pen.width, // width\n      this.defatultStyle.lineHeight // height\n      );\n    }\n  },\n\n  clear() {\n    var canvas = this.canvas;\n    this.context.clearRect(0, 0, canvas.width, canvas.height);\n  },\n\n  drawBackground(color) {\n    if (color === null) {\n      return;\n    }\n\n    this.context.fillStyle = color;\n    this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\n  },\n\n  drawUnderline(x, y, width, style) {\n    y += style.underlineOffset - style.underlineThickness / 2;\n\n    if (this.autoRound) {\n      x = Math.round(x);\n      y = Math.round(y);\n    }\n\n    var context = this.context;\n    var savedLineCap = context.lineCap;\n    context.lineCap = 'butt';\n    context.beginPath();\n    context.strokeStyle = style.underlineColor;\n    context.lineWidth = style.underlineThickness;\n    context.moveTo(x, y);\n    context.lineTo(x + width, y);\n    context.stroke();\n    context.lineCap = savedLineCap;\n  },\n\n  drawText(x, y, text, style) {\n    if (this.autoRound) {\n      x = Math.round(x);\n      y = Math.round(y);\n    }\n\n    var context = this.context;\n\n    if (style.strokeThickness) {\n      style.syncShadow(context, style.shadowStroke);\n      context.strokeText(text, x, y);\n    }\n\n    if (style.color && style.color !== 'none') {\n      style.syncShadow(context, style.shadowFill);\n      context.fillText(text, x, y);\n    }\n  },\n\n  drawImage(x, y, imgKey, style) {\n    var imageManager = this.parent.imageManager;\n    var imgData = imageManager.get(imgKey);\n    var frame = imageManager.getFrame(imgKey);\n    x += imgData.left;\n    y += -this.startYOffset + imgData.y;\n\n    if (this.autoRound) {\n      x = Math.round(x);\n      y = Math.round(y);\n    }\n\n    var context = this.context;\n    context.drawImage(frame.source.image, frame.cutX, frame.cutY, frame.cutWidth, frame.cutHeight, x, y, imgData.width, imgData.height);\n  }\n\n};","map":{"version":3,"sources":["/home/jon/code/Projects/Soulys/frontend/node_modules/phaser3-rex-plugins/plugins/gameobjects/text/textbase/canvastext/DrawMethods.js"],"names":["draw","startX","startY","boxWidth","boxHeight","penManager","hitAreaManager","clear","context","save","drawBackground","defatultStyle","backgroundColor","startXOffset","startYOffset","halign","valign","lineWidth","lineHeight","lines","totalLinesNum","length","maxLines","drawLinesNum","drawLineStartIdx","drawLineEndIdx","Math","floor","offsetX","offsetY","max","lineIdx","getLineWidth","pens","penIdx","pensLen","drawPen","restore","pen","x","y","canvas","curStyle","parser","propToContextStyle","prop","buildFont","syncFont","syncStyle","underlineThickness","width","drawUnderline","isTextPen","drawText","text","isImagePen","drawImage","img","hasAreaMarker","add","area","clearRect","height","color","fillStyle","fillRect","style","underlineOffset","autoRound","round","savedLineCap","lineCap","beginPath","strokeStyle","underlineColor","moveTo","lineTo","stroke","strokeThickness","syncShadow","shadowStroke","strokeText","shadowFill","fillText","imgKey","imageManager","parent","imgData","get","frame","getFrame","left","source","image","cutX","cutY","cutWidth","cutHeight"],"mappings":"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","sourcesContent":["export default {\r\n    draw(startX, startY, boxWidth, boxHeight) {\r\n        var penManager = this.penManager;\r\n        this.hitAreaManager.clear();\r\n\r\n        var context = this.context;\r\n        context.save();\r\n\r\n        // this.clear();\r\n        this.drawBackground(this.defatultStyle.backgroundColor);\r\n\r\n        // draw lines\r\n        var defatultStyle = this.defatultStyle;\r\n        startX += this.startXOffset;\r\n        startY += this.startYOffset;\r\n        var halign = defatultStyle.halign,\r\n            valign = defatultStyle.valign;\r\n\r\n        var lineWidth, lineHeight = defatultStyle.lineHeight;\r\n        var lines = penManager.lines;\r\n        var totalLinesNum = lines.length,\r\n            maxLines = defatultStyle.maxLines;\r\n        var drawLinesNum, drawLineStartIdx, drawLineEndIdx;\r\n        if ((maxLines > 0) && (totalLinesNum > maxLines)) {\r\n            drawLinesNum = maxLines;\r\n            if (valign === 'center') { // center\r\n                drawLineStartIdx = Math.floor((totalLinesNum - drawLinesNum) / 2);\r\n            } else if (valign === 'bottom') { // bottom\r\n                drawLineStartIdx = totalLinesNum - drawLinesNum;\r\n            } else {\r\n                drawLineStartIdx = 0;\r\n            }\r\n        } else {\r\n            drawLinesNum = totalLinesNum;\r\n            drawLineStartIdx = 0;\r\n        }\r\n        drawLineEndIdx = drawLineStartIdx + drawLinesNum;\r\n\r\n        var offsetX, offsetY;\r\n        if (valign === 'center') { // center\r\n            offsetY = Math.max((boxHeight - (drawLinesNum * lineHeight)) / 2, 0);\r\n        } else if (valign === 'bottom') { // bottom\r\n            offsetY = Math.max(boxHeight - (drawLinesNum * lineHeight) - 2, 0);\r\n        } else {\r\n            offsetY = 0;\r\n        }\r\n        offsetY += startY;\r\n        for (var lineIdx = drawLineStartIdx; lineIdx < drawLineEndIdx; lineIdx++) {\r\n            lineWidth = penManager.getLineWidth(lineIdx);\r\n            if (lineWidth === 0) {\r\n                continue;\r\n            }\r\n\r\n            if (halign === 'center') { // center\r\n                offsetX = (boxWidth - lineWidth) / 2;\r\n            } else if (halign === 'right') { // right\r\n                offsetX = boxWidth - lineWidth;\r\n            } else {\r\n                offsetX = 0;\r\n            }\r\n            offsetX += startX;\r\n\r\n            var pens = lines[lineIdx];\r\n            for (var penIdx = 0, pensLen = pens.length; penIdx < pensLen; penIdx++) {\r\n                this.drawPen(pens[penIdx], offsetX, offsetY);\r\n            }\r\n        }\r\n\r\n        context.restore();\r\n    },\r\n\r\n    drawPen(pen, offsetX, offsetY) {\r\n        offsetX += pen.x;\r\n        offsetY += pen.y;\r\n\r\n        var canvas = this.canvas;\r\n        var context = this.context;\r\n        context.save();\r\n\r\n        var curStyle = this.parser.propToContextStyle(\r\n            this.defatultStyle,\r\n            pen.prop\r\n        );\r\n        curStyle.buildFont();\r\n        curStyle.syncFont(canvas, context);\r\n        curStyle.syncStyle(canvas, context);\r\n\r\n        // Underline\r\n        if ((curStyle.underlineThickness > 0) && (pen.width > 0)) {\r\n            this.drawUnderline(offsetX, offsetY, pen.width, curStyle);\r\n        }\r\n\r\n        // Text\r\n        if (pen.isTextPen) {\r\n            this.drawText(offsetX, offsetY, pen.text, curStyle);\r\n        }\r\n\r\n        // Image\r\n        if (pen.isImagePen) {\r\n            this.drawImage(offsetX, offsetY, pen.prop.img, curStyle);\r\n        }\r\n\r\n        context.restore();\r\n\r\n        if (pen.hasAreaMarker && (pen.width > 0)) {\r\n            this.hitAreaManager.add(\r\n                pen.prop.area, // key\r\n                offsetX, // x\r\n                (offsetY - this.startYOffset), // y\r\n                pen.width, // width\r\n                this.defatultStyle.lineHeight // height\r\n            );\r\n        }\r\n    },\r\n\r\n    clear() {\r\n        var canvas = this.canvas;\r\n        this.context.clearRect(0, 0, canvas.width, canvas.height);\r\n    },\r\n\r\n    drawBackground(color) {\r\n        if (color === null) {\r\n            return;\r\n        }\r\n        this.context.fillStyle = color;\r\n        this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n    },\r\n\r\n    drawUnderline(x, y, width, style) {\r\n        y += style.underlineOffset - (style.underlineThickness / 2);\r\n        if (this.autoRound) {\r\n            x = Math.round(x);\r\n            y = Math.round(y);\r\n        }\r\n\r\n        var context = this.context;\r\n        var savedLineCap = context.lineCap;\r\n        context.lineCap = 'butt';\r\n        context.beginPath();\r\n        context.strokeStyle = style.underlineColor;\r\n        context.lineWidth = style.underlineThickness;\r\n        context.moveTo(x, y);\r\n        context.lineTo((x + width), y);\r\n        context.stroke();\r\n        context.lineCap = savedLineCap;\r\n    },\r\n\r\n    drawText(x, y, text, style) {\r\n        if (this.autoRound) {\r\n            x = Math.round(x);\r\n            y = Math.round(y);\r\n        }\r\n\r\n        var context = this.context;\r\n        if (style.strokeThickness) {\r\n            style.syncShadow(context, style.shadowStroke);\r\n            context.strokeText(text, x, y);\r\n        }\r\n\r\n        if (style.color && (style.color !== 'none')) {\r\n            style.syncShadow(context, style.shadowFill);\r\n            context.fillText(text, x, y);\r\n        }\r\n    },\r\n\r\n    drawImage(x, y, imgKey, style) {\r\n        var imageManager = this.parent.imageManager;\r\n        var imgData = imageManager.get(imgKey);\r\n        var frame = imageManager.getFrame(imgKey);\r\n\r\n        x += imgData.left;\r\n        y += - this.startYOffset + imgData.y;\r\n        if (this.autoRound) {\r\n            x = Math.round(x);\r\n            y = Math.round(y);\r\n        }\r\n\r\n        var context = this.context;\r\n        context.drawImage(\r\n            frame.source.image,\r\n            frame.cutX, frame.cutY, frame.cutWidth, frame.cutHeight,\r\n            x, y, imgData.width, imgData.height\r\n        );\r\n    }\r\n\r\n}"]},"metadata":{},"sourceType":"module"}