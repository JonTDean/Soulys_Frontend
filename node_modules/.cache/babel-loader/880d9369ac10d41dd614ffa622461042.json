{"ast":null,"code":"import TwoPointersTracer from '../twopointerstracer/TwoPointersTracer.js';\nimport FSM from '../../../fsm.js';\nimport SpinObject from './SpinObject.js';\nconst GetValue = Phaser.Utils.Objects.GetValue;\nconst WrapDegrees = Phaser.Math.Angle.WrapDegrees; // Wrap degrees: -180 to 180 \n\nconst ShortestBetween = Phaser.Math.Angle.ShortestBetween;\nconst RadToDeg = Phaser.Math.RadToDeg;\nconst DegToRad = Phaser.Math.DegToRad;\n\nclass Rotate extends TwoPointersTracer {\n  constructor(scene, config) {\n    super(scene, config);\n    var self = this;\n    var stateConfig = {\n      states: {\n        IDLE: {\n          enter: function () {\n            self.prevAngle = undefined;\n            self.angle = 0;\n          }\n        },\n        BEGIN: {},\n        RECOGNIZED: {\n          enter: function () {\n            self.emit('rotatestart', self);\n          },\n          exit: function () {\n            self.emit('rotateend', self);\n          }\n        }\n      },\n      init: function () {\n        this.state = IDLE;\n      },\n      eventEmitter: false\n    };\n    this.setRecongizedStateObject(new FSM(stateConfig));\n  }\n\n  resetFromJSON(o) {\n    super.resetFromJSON(o);\n    this.setDragThreshold(GetValue(o, 'threshold', 0));\n    return this;\n  }\n\n  onDrag2Start() {\n    this.prevAngle = WrapDegrees(RadToDeg(this.angleBetween)); // Degrees\n\n    this.state = BEGIN;\n\n    if (this.rotationThreshold === 0) {\n      this.state = RECOGNIZED;\n    }\n  }\n\n  onDrag2End() {\n    this.state = IDLE;\n  }\n\n  onDrag2() {\n    switch (this.state) {\n      case BEGIN:\n        if (this.pointers[0].getDistance() >= this.dragThreshold && this.pointers[1].getDistance() >= this.dragThreshold) {\n          var curAngle = WrapDegrees(RadToDeg(this.angleBetween));\n          this.angle = ShortestBetween(this.prevAngle, curAngle);\n          this.prevAngle = curAngle;\n          this.state = RECOGNIZED;\n        }\n\n        break;\n\n      case RECOGNIZED:\n        var curAngle = WrapDegrees(RadToDeg(this.angleBetween));\n        this.angle = ShortestBetween(this.prevAngle, curAngle);\n        this.prevAngle = curAngle;\n        this.emit('rotate', this);\n        break;\n    }\n  }\n\n  get isRotation() {\n    return this.state === RECOGNIZED;\n  }\n\n  get rotation() {\n    return DegToRad(this.angle);\n  }\n\n  setDragThreshold(distance) {\n    this.dragThreshold = distance;\n    return this;\n  }\n\n}\n\nvar methods = {\n  spinObject: SpinObject\n};\nObject.assign(Rotate.prototype, methods);\nconst IDLE = 'IDLE';\nconst BEGIN = 'BEGIN';\nconst RECOGNIZED = 'RECOGNIZED';\nexport default Rotate;","map":{"version":3,"sources":["/home/jon/code/Projects/Soulys/frontend/node_modules/phaser3-rex-plugins/plugins/input/gestures/rotate/Rotate.js"],"names":["TwoPointersTracer","FSM","SpinObject","GetValue","Phaser","Utils","Objects","WrapDegrees","Math","Angle","ShortestBetween","RadToDeg","DegToRad","Rotate","constructor","scene","config","self","stateConfig","states","IDLE","enter","prevAngle","undefined","angle","BEGIN","RECOGNIZED","emit","exit","init","state","eventEmitter","setRecongizedStateObject","resetFromJSON","o","setDragThreshold","onDrag2Start","angleBetween","rotationThreshold","onDrag2End","onDrag2","pointers","getDistance","dragThreshold","curAngle","isRotation","rotation","distance","methods","spinObject","Object","assign","prototype"],"mappings":"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","sourcesContent":["import TwoPointersTracer from '../twopointerstracer/TwoPointersTracer.js';\r\nimport FSM from '../../../fsm.js';\r\nimport SpinObject from './SpinObject.js';\r\n\r\nconst GetValue = Phaser.Utils.Objects.GetValue;\r\nconst WrapDegrees = Phaser.Math.Angle.WrapDegrees; // Wrap degrees: -180 to 180 \r\nconst ShortestBetween = Phaser.Math.Angle.ShortestBetween;\r\nconst RadToDeg = Phaser.Math.RadToDeg;\r\nconst DegToRad = Phaser.Math.DegToRad;\r\n\r\nclass Rotate extends TwoPointersTracer {\r\n    constructor(scene, config) {\r\n        super(scene, config);\r\n\r\n        var self = this;\r\n        var stateConfig = {\r\n            states: {\r\n                IDLE: {\r\n                    enter: function () {\r\n                        self.prevAngle = undefined;\r\n                        self.angle = 0;\r\n                    },\r\n                },\r\n                BEGIN: {\r\n                },\r\n                RECOGNIZED: {\r\n                    enter: function () {\r\n                        self.emit('rotatestart', self);\r\n                    },\r\n                    exit: function () {\r\n                        self.emit('rotateend', self);\r\n                    }\r\n                }\r\n            },\r\n            init: function () {\r\n                this.state = IDLE;\r\n            },\r\n            eventEmitter: false,\r\n        }\r\n        this.setRecongizedStateObject(new FSM(stateConfig));\r\n    }\r\n\r\n    resetFromJSON(o) {\r\n        super.resetFromJSON(o);\r\n        this.setDragThreshold(GetValue(o, 'threshold', 0));\r\n        return this;\r\n    }\r\n\r\n    onDrag2Start() {\r\n        this.prevAngle = WrapDegrees(RadToDeg(this.angleBetween)); // Degrees\r\n        this.state = BEGIN;\r\n        if (this.rotationThreshold === 0) {\r\n            this.state = RECOGNIZED;\r\n        }\r\n    }\r\n\r\n    onDrag2End() {\r\n        this.state = IDLE;\r\n    }\r\n\r\n    onDrag2() {\r\n        switch (this.state) {\r\n            case BEGIN:\r\n                if ((this.pointers[0].getDistance() >= this.dragThreshold) &&\r\n                    (this.pointers[1].getDistance() >= this.dragThreshold)) {\r\n                    var curAngle = WrapDegrees(RadToDeg(this.angleBetween));\r\n                    this.angle = ShortestBetween(this.prevAngle, curAngle);\r\n                    this.prevAngle = curAngle;\r\n                    this.state = RECOGNIZED;\r\n                }\r\n                break;\r\n            case RECOGNIZED:\r\n                var curAngle = WrapDegrees(RadToDeg(this.angleBetween));\r\n                this.angle = ShortestBetween(this.prevAngle, curAngle);\r\n                this.prevAngle = curAngle;\r\n                this.emit('rotate', this);\r\n                break;\r\n        }\r\n    }\r\n\r\n    get isRotation() {\r\n        return (this.state === RECOGNIZED);\r\n    }\r\n\r\n    get rotation() {\r\n        return DegToRad(this.angle);\r\n    }\r\n\r\n    setDragThreshold(distance) {\r\n        this.dragThreshold = distance;\r\n        return this;\r\n    }\r\n\r\n}\r\n\r\nvar methods = {\r\n    spinObject: SpinObject,\r\n};\r\nObject.assign(\r\n    Rotate.prototype,\r\n    methods\r\n);\r\n\r\n\r\nconst IDLE = 'IDLE';\r\nconst BEGIN = 'BEGIN';\r\nconst RECOGNIZED = 'RECOGNIZED';\r\n\r\nexport default Rotate;"]},"metadata":{},"sourceType":"module"}