{"ast":null,"code":"import Cell from './Cell.js';\nimport Pool from '../../pool.js';\nconst GetValue = Phaser.Utils.Objects.GetValue;\nconst SpliceOne = Phaser.Utils.Array.SpliceOne;\n\nclass Table {\n  constructor(parent, config) {\n    this.parent = parent; // parent: GridTable game object (Container)\n\n    this.cells = [];\n    this.cellPool = new Pool();\n    this.resetFromJSON(config);\n  }\n\n  resetFromJSON(o) {\n    this.colCount = undefined;\n    this._nonZeroDeltaHeightCount = 0;\n    this.resetTotalRowsHeight();\n    this.setDefaultCellHeight(GetValue(o, 'cellHeight', 30));\n    this.setDefaultCellWidth(GetValue(o, 'cellWidth', 30));\n    this.initCells(GetValue(o, 'cellsCount', 0));\n    this.setColumnCount(GetValue(o, 'columns', 1));\n    return this;\n  }\n\n  destroy(fromScene) {\n    for (var i = 0, cnt = this.cells.length; i < cnt; i++) {\n      this.freeCell(this.cells[i], fromScene);\n    }\n\n    this.cellPool.destroy();\n    this.cells = undefined;\n    this.parent = undefined;\n  }\n\n  get nonZeroDeltaHeightCount() {\n    return this._nonZeroDeltaHeightCount;\n  }\n\n  set nonZeroDeltaHeightCount(count) {\n    if (this._nonZeroDeltaHeightCount === count) {\n      return;\n    }\n\n    this._nonZeroDeltaHeightCount = count;\n    this.resetTotalRowsHeight();\n  }\n\n  get defaultCellHeightMode() {\n    return this.nonZeroDeltaHeightCount === 0;\n  }\n\n  setDefaultCellHeight(height) {\n    this.defaultCellHeight = height;\n    return this;\n  }\n\n  setDefaultCellWidth(width) {\n    this.defaultCellWidth = width;\n    return this;\n  }\n\n  initCells(size) {\n    var cells = this.cells;\n    cells.length = size;\n\n    for (var i = 0; i < size; i++) {\n      cells[i] = null;\n    }\n\n    return this;\n  }\n\n  insertNewCells(cellIdx, count) {\n    var cells = this.cells;\n\n    if (cellIdx === cells.length) {\n      // append at end of array\n      var endIdx = cellIdx + count;\n      cells.legth = endIdx;\n\n      for (var i = cellIdx; i < endIdx; i++) {\n        cells[i] = null;\n      }\n    } else {\n      var newCells = [];\n      newCells.length = count;\n\n      for (var i = 0; i < count; i++) {\n        newCells[i] = null;\n      }\n\n      this.cells.splice(cellIdx, 0, ...newCells);\n    }\n\n    this.resetTotalRowsHeight();\n    return this;\n  }\n\n  removeCells(cellIdx, count) {\n    var endIdx = cellIdx + count;\n\n    for (var i = cellIdx; i < endIdx; i++) {\n      this.freeCell(i);\n    }\n\n    if (endIdx === this.cells.length) {\n      // remove until end of array\n      this.cells.length = cellIdx;\n    } else {\n      if (count === 1) {\n        SpliceOne(this.cells, cellIdx);\n      } else {\n        this.cells.splice(cellIdx, count);\n      }\n\n      this.buildCellIndex(cellIdx);\n    }\n\n    this.resetTotalRowsHeight();\n    return this;\n  }\n\n  setColumnCount(cnt) {\n    this.colCount = cnt;\n    this.resetTotalRowsHeight();\n    return this;\n  }\n\n  get rowCount() {\n    return Math.ceil(this.cells.length / this.colCount);\n  }\n\n  get cellsCount() {\n    return this.cells.length;\n  }\n\n  isValidCellIdx(idx) {\n    return idx >= 0 && idx < this.cells.length;\n  }\n\n  heightToRowIndex(height, isCeil) {\n    // defaultCellHeightMode\n    if (this.defaultCellHeightMode) {\n      var rowIdx = height / this.defaultCellHeight;\n\n      if (isCeil) {\n        rowIdx = Math.ceil(rowIdx);\n      } else {\n        rowIdx = Math.floor(rowIdx);\n      }\n\n      return rowIdx;\n    } // count cell height one by one\n\n\n    var rowCount = this.rowCount;\n    var remainder = height,\n        isValidIdx;\n    var cell,\n        rowHeight,\n        rowIdx = 0;\n\n    while (1) {\n      rowHeight = this.getRowHeight(rowIdx);\n      remainder -= rowHeight;\n      isValidIdx = rowIdx >= 0 && rowIdx < rowCount;\n\n      if (remainder > 0 && isValidIdx) {\n        rowIdx += 1;\n      } else if (remainder === 0) {\n        return rowIdx;\n      } else {\n        if (isCeil) {\n          var preRowIdx = rowIdx;\n          rowIdx += 1;\n          isValidIdx = rowIdx >= 0 && rowIdx < rowCount;\n          if (!isValidIdx) rowIdx = preRowIdx;\n        }\n\n        return rowIdx;\n      }\n    }\n  }\n\n  widthToColIndex(width, isCeil) {\n    var colIdx = width / this.defaultCellWidth;\n\n    if (isCeil) {\n      colIdx = Math.ceil(colIdx);\n    } else {\n      colIdx = Math.floor(colIdx);\n    }\n\n    return colIdx;\n  }\n\n  colRowToCellIndex(colIdx, rowIdx) {\n    if (colIdx >= this.colCount) {\n      return null;\n    }\n\n    return rowIdx * this.colCount + colIdx;\n  }\n\n  rowIndexToHeight(start, end) {\n    // defaultCellHeightMode\n    if (this.defaultCellHeightMode) {\n      return (end - start + 1) * this.defaultCellHeight;\n    }\n\n    var h,\n        sum = 0;\n\n    for (var i = start; i <= end; i++) {\n      h = this.getRowHeight(i);\n      sum += h;\n    }\n\n    return sum;\n  }\n\n  colIndexToWidth(start, end) {\n    return (end - start + 1) * this.defaultCellWidth;\n  }\n\n  getRowHeight(rowIdx) {\n    var cnt = this.colCount; // single column\n\n    if (cnt <= 1) {\n      return this.getCellHeight(this.colRowToCellIndex(0, rowIdx));\n    } // multiple columns, get the maximum height\n\n\n    var maxHeight = 0,\n        cellHeight;\n\n    for (var i = 0; i < cnt; i++) {\n      cellHeight = this.getCellHeight(this.colRowToCellIndex(i, rowIdx));\n      if (maxHeight < cellHeight) maxHeight = cellHeight;\n    }\n\n    return maxHeight;\n  }\n\n  getColWidth(idx) {\n    return this.defaultCellWidth;\n  }\n\n  getCellHeight(cellIdx) {\n    if (!this.isValidCellIdx(cellIdx)) {\n      return 0;\n    }\n\n    var cellHeight;\n    if (this.defaultCellHeightMode) cellHeight = this.defaultCellHeight;else {\n      var cell = this.getCell(cellIdx, false);\n      var deltaHeight = cell ? cell.deltaHeight : 0;\n      cellHeight = this.defaultCellHeight + deltaHeight;\n    }\n    return cellHeight;\n  }\n\n  resetTotalRowsHeight() {\n    this._totalRowsHeight = null;\n  }\n\n  get totalRowsHeight() {\n    if (this._totalRowsHeight === null) {\n      this._totalRowsHeight = this.rowIndexToHeight(0, this.rowCount - 1);\n    }\n\n    return this._totalRowsHeight;\n  }\n\n  get totalColumnWidth() {\n    return this.colCount * this.defaultCellWidth;\n  }\n\n  cellIndxeToColIndex(cellIdx) {\n    return cellIdx % this.colCount;\n  }\n\n  cellIndxeToRowIndex(cellIdx) {\n    return Math.floor(cellIdx / this.colCount);\n  }\n\n  getCell(cellIdx, createNewCell) {\n    if (!this.isValidCellIdx(cellIdx)) {\n      return null;\n    }\n\n    if (createNewCell === undefined) {\n      createNewCell = true;\n    }\n\n    if (this.cells[cellIdx] === null && createNewCell) {\n      var cell = this.newCell(cellIdx);\n      this.cells[cellIdx] = cell;\n    }\n\n    return this.cells[cellIdx];\n  }\n\n  newCell(cellIdx) {\n    var cell = this.cellPool.pop();\n\n    if (cell === null) {\n      cell = new Cell(this);\n    } else {\n      cell.setParent(this);\n    }\n\n    cell.index = cellIdx;\n    return cell;\n  }\n\n  buildCellIndex(startIdx) {\n    if (startIdx === undefined) {\n      startIdx = 0;\n    }\n\n    var cells = this.cells,\n        cell;\n\n    for (var i = startIdx, len = cells.length; i < len; i++) {\n      cell = cells[i];\n\n      if (cell) {\n        cell.index = i;\n      }\n    }\n\n    return this;\n  }\n\n  getParentContainer() {\n    return this.parent;\n  }\n\n  freeCell(cell, fromScene) {\n    if (typeof cell === 'number') {\n      cell = this.cells[cell];\n    }\n\n    if (!cell) {\n      return this;\n    }\n\n    cell.destroy(fromScene);\n\n    if (!fromScene) {\n      this.cellPool.push(cell);\n    }\n\n    return this;\n  }\n\n}\n\nexport default Table;","map":{"version":3,"sources":["/home/jon/code/Projects/Soulys/frontend/node_modules/phaser3-rex-plugins/plugins/gameobjects/gridtable/Table.js"],"names":["Cell","Pool","GetValue","Phaser","Utils","Objects","SpliceOne","Array","Table","constructor","parent","config","cells","cellPool","resetFromJSON","o","colCount","undefined","_nonZeroDeltaHeightCount","resetTotalRowsHeight","setDefaultCellHeight","setDefaultCellWidth","initCells","setColumnCount","destroy","fromScene","i","cnt","length","freeCell","nonZeroDeltaHeightCount","count","defaultCellHeightMode","height","defaultCellHeight","width","defaultCellWidth","size","insertNewCells","cellIdx","endIdx","legth","newCells","splice","removeCells","buildCellIndex","rowCount","Math","ceil","cellsCount","isValidCellIdx","idx","heightToRowIndex","isCeil","rowIdx","floor","remainder","isValidIdx","cell","rowHeight","getRowHeight","preRowIdx","widthToColIndex","colIdx","colRowToCellIndex","rowIndexToHeight","start","end","h","sum","colIndexToWidth","getCellHeight","maxHeight","cellHeight","getColWidth","getCell","deltaHeight","_totalRowsHeight","totalRowsHeight","totalColumnWidth","cellIndxeToColIndex","cellIndxeToRowIndex","createNewCell","newCell","pop","setParent","index","startIdx","len","getParentContainer","push"],"mappings":"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","sourcesContent":["import Cell from './Cell.js';\r\nimport Pool from '../../pool.js';\r\n\r\nconst GetValue = Phaser.Utils.Objects.GetValue;\r\nconst SpliceOne = Phaser.Utils.Array.SpliceOne;\r\n\r\nclass Table {\r\n    constructor(parent, config) {\r\n        this.parent = parent; // parent: GridTable game object (Container)\r\n        this.cells = [];\r\n        this.cellPool = new Pool();\r\n        this.resetFromJSON(config);\r\n    }\r\n\r\n    resetFromJSON(o) {\r\n        this.colCount = undefined;\r\n        this._nonZeroDeltaHeightCount = 0;\r\n        this.resetTotalRowsHeight();\r\n        this.setDefaultCellHeight(GetValue(o, 'cellHeight', 30));\r\n        this.setDefaultCellWidth(GetValue(o, 'cellWidth', 30));\r\n        this.initCells(GetValue(o, 'cellsCount', 0));\r\n        this.setColumnCount(GetValue(o, 'columns', 1));\r\n        return this;\r\n    }\r\n\r\n    destroy(fromScene) {\r\n        for (var i = 0, cnt = this.cells.length; i < cnt; i++) {\r\n            this.freeCell(this.cells[i], fromScene);\r\n        }\r\n        this.cellPool.destroy();\r\n        this.cells = undefined;\r\n        this.parent = undefined;\r\n    }\r\n\r\n    get nonZeroDeltaHeightCount() {\r\n        return this._nonZeroDeltaHeightCount;\r\n    }\r\n\r\n    set nonZeroDeltaHeightCount(count) {\r\n        if (this._nonZeroDeltaHeightCount === count) {\r\n            return;\r\n        }\r\n        this._nonZeroDeltaHeightCount = count;\r\n        this.resetTotalRowsHeight();\r\n    }\r\n\r\n    get defaultCellHeightMode() {\r\n        return (this.nonZeroDeltaHeightCount === 0);\r\n    }\r\n\r\n    setDefaultCellHeight(height) {\r\n        this.defaultCellHeight = height;\r\n        return this;\r\n    }\r\n\r\n    setDefaultCellWidth(width) {\r\n        this.defaultCellWidth = width;\r\n        return this;\r\n    }\r\n\r\n    initCells(size) {\r\n        var cells = this.cells;\r\n        cells.length = size;\r\n        for (var i = 0; i < size; i++) {\r\n            cells[i] = null;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    insertNewCells(cellIdx, count) {\r\n        var cells = this.cells;\r\n        if (cellIdx === cells.length) {\r\n            // append at end of array\r\n            var endIdx = cellIdx + count;\r\n            cells.legth = endIdx;\r\n            for (var i = cellIdx; i < endIdx; i++) {\r\n                cells[i] = null;\r\n            }\r\n        } else {\r\n            var newCells = [];\r\n            newCells.length = count;\r\n            for (var i = 0; i < count; i++) {\r\n                newCells[i] = null;\r\n            }\r\n            this.cells.splice(cellIdx, 0, ...newCells);\r\n        }\r\n\r\n        this.resetTotalRowsHeight();\r\n        return this;\r\n    }\r\n\r\n    removeCells(cellIdx, count) {\r\n        var endIdx = cellIdx + count;\r\n        for (var i = cellIdx; i < endIdx; i++) {\r\n            this.freeCell(i);\r\n        }\r\n\r\n        if (endIdx === this.cells.length) {\r\n            // remove until end of array\r\n            this.cells.length = cellIdx;\r\n        } else {\r\n            if (count === 1) {\r\n                SpliceOne(this.cells, cellIdx);\r\n            } else {\r\n                this.cells.splice(cellIdx, count);\r\n            }\r\n            this.buildCellIndex(cellIdx);\r\n        }\r\n\r\n        this.resetTotalRowsHeight();\r\n        return this;\r\n    }\r\n\r\n    setColumnCount(cnt) {\r\n        this.colCount = cnt;\r\n        this.resetTotalRowsHeight();\r\n        return this;\r\n    }\r\n\r\n    get rowCount() {\r\n        return Math.ceil(this.cells.length / this.colCount);\r\n    }\r\n\r\n    get cellsCount() {\r\n        return this.cells.length;\r\n    }\r\n\r\n    isValidCellIdx(idx) {\r\n        return ((idx >= 0) && (idx < this.cells.length));\r\n    }\r\n\r\n    heightToRowIndex(height, isCeil) {\r\n        // defaultCellHeightMode\r\n        if (this.defaultCellHeightMode) {\r\n            var rowIdx = height / this.defaultCellHeight;\r\n            if (isCeil) {\r\n                rowIdx = Math.ceil(rowIdx);\r\n            } else {\r\n                rowIdx = Math.floor(rowIdx);\r\n            }\r\n\r\n            return rowIdx;\r\n        }\r\n\r\n        // count cell height one by one\r\n        var rowCount = this.rowCount;\r\n        var remainder = height,\r\n            isValidIdx;\r\n        var cell, rowHeight, rowIdx = 0;\r\n\r\n        while (1) {\r\n            rowHeight = this.getRowHeight(rowIdx);\r\n            remainder -= rowHeight;\r\n\r\n            isValidIdx = (rowIdx >= 0) && (rowIdx < rowCount);\r\n            if ((remainder > 0) && isValidIdx) {\r\n                rowIdx += 1;\r\n            } else if (remainder === 0) {\r\n                return rowIdx;\r\n            } else {\r\n                if (isCeil) {\r\n                    var preRowIdx = rowIdx;\r\n                    rowIdx += 1;\r\n                    isValidIdx = (rowIdx >= 0) && (rowIdx < rowCount);\r\n\r\n                    if (!isValidIdx)\r\n                        rowIdx = preRowIdx;\r\n                }\r\n\r\n                return rowIdx;\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    widthToColIndex(width, isCeil) {\r\n        var colIdx = width / this.defaultCellWidth;\r\n        if (isCeil) {\r\n            colIdx = Math.ceil(colIdx);\r\n        } else {\r\n            colIdx = Math.floor(colIdx);\r\n        }\r\n\r\n        return colIdx;\r\n    }\r\n\r\n    colRowToCellIndex(colIdx, rowIdx) {\r\n        if (colIdx >= this.colCount) {\r\n            return null;\r\n        }\r\n        return (rowIdx * this.colCount) + colIdx;\r\n    }\r\n\r\n    rowIndexToHeight(start, end) {\r\n        // defaultCellHeightMode\r\n        if (this.defaultCellHeightMode) {\r\n            return (end - start + 1) * this.defaultCellHeight;\r\n        }\r\n\r\n        var h, sum = 0;\r\n        for (var i = start; i <= end; i++) {\r\n            h = this.getRowHeight(i);\r\n            sum += h;\r\n        }\r\n\r\n        return sum;\r\n    }\r\n\r\n    colIndexToWidth(start, end) {\r\n        return (end - start + 1) * this.defaultCellWidth;\r\n    };\r\n\r\n    getRowHeight(rowIdx) {\r\n        var cnt = this.colCount;\r\n        // single column\r\n        if (cnt <= 1) {\r\n            return this.getCellHeight(this.colRowToCellIndex(0, rowIdx));\r\n        }\r\n\r\n        // multiple columns, get the maximum height\r\n        var maxHeight = 0,\r\n            cellHeight;\r\n        for (var i = 0; i < cnt; i++) {\r\n            cellHeight = this.getCellHeight(this.colRowToCellIndex(i, rowIdx));\r\n            if (maxHeight < cellHeight)\r\n                maxHeight = cellHeight;\r\n        }\r\n        return maxHeight;\r\n    }\r\n\r\n    getColWidth(idx) {\r\n        return this.defaultCellWidth;\r\n    }\r\n\r\n    getCellHeight(cellIdx) {\r\n        if (!this.isValidCellIdx(cellIdx)) {\r\n            return 0;\r\n        }\r\n\r\n        var cellHeight;\r\n        if (this.defaultCellHeightMode)\r\n            cellHeight = this.defaultCellHeight;\r\n        else {\r\n            var cell = this.getCell(cellIdx, false);\r\n            var deltaHeight = (cell) ? cell.deltaHeight : 0;\r\n            cellHeight = this.defaultCellHeight + deltaHeight;\r\n        }\r\n\r\n        return cellHeight;\r\n    }\r\n\r\n    resetTotalRowsHeight() {\r\n        this._totalRowsHeight = null;\r\n    }\r\n\r\n    get totalRowsHeight() {\r\n        if (this._totalRowsHeight === null) {\r\n            this._totalRowsHeight = this.rowIndexToHeight(0, this.rowCount - 1);\r\n        }\r\n\r\n        return this._totalRowsHeight;\r\n    }\r\n\r\n    get totalColumnWidth() {\r\n        return this.colCount * this.defaultCellWidth;\r\n    }\r\n\r\n    cellIndxeToColIndex(cellIdx) {\r\n        return cellIdx % this.colCount;\r\n    }\r\n\r\n    cellIndxeToRowIndex(cellIdx) {\r\n        return Math.floor(cellIdx / this.colCount);\r\n    }\r\n\r\n    getCell(cellIdx, createNewCell) {\r\n        if (!this.isValidCellIdx(cellIdx)) {\r\n            return null;\r\n        }\r\n\r\n        if (createNewCell === undefined) {\r\n            createNewCell = true;\r\n        }\r\n        if ((this.cells[cellIdx] === null) && createNewCell) {\r\n            var cell = this.newCell(cellIdx);\r\n            this.cells[cellIdx] = cell;\r\n        }\r\n\r\n        return this.cells[cellIdx];\r\n    }\r\n\r\n    newCell(cellIdx) {\r\n        var cell = this.cellPool.pop();\r\n        if (cell === null) {\r\n            cell = new Cell(this);\r\n        } else {\r\n            cell.setParent(this);\r\n        }\r\n        cell.index = cellIdx;\r\n\r\n        return cell;\r\n    }\r\n\r\n    buildCellIndex(startIdx) {\r\n        if (startIdx === undefined) {\r\n            startIdx = 0;\r\n        }\r\n        var cells = this.cells,\r\n            cell;\r\n        for (var i = startIdx, len = cells.length; i < len; i++) {\r\n            cell = cells[i];\r\n            if (cell) {\r\n                cell.index = i;\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    getParentContainer() {\r\n        return this.parent;\r\n    }\r\n\r\n    freeCell(cell, fromScene) {\r\n        if (typeof (cell) === 'number') {\r\n            cell = this.cells[cell];\r\n        }\r\n\r\n        if (!cell) {\r\n            return this;\r\n        }\r\n\r\n        cell.destroy(fromScene);\r\n        if (!fromScene) {\r\n            this.cellPool.push(cell);\r\n        }\r\n        return this;\r\n    }\r\n}\r\n\r\nexport default Table;"]},"metadata":{},"sourceType":"module"}