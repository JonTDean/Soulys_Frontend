{"ast":null,"code":"import GetSceneObject from '../../utils/system/GetSceneObject.js';\nimport EventEmitterMethods from '../../utils/eventemitter/EventEmitterMethods.js';\nimport State from './State.js';\nimport DrapSpeed from '../../dragspeed.js';\nimport SlowDown from '../../utils/movement/SlowDown.js';\nconst GetValue = Phaser.Utils.Objects.GetValue;\n\nclass Scroller {\n  constructor(gameObject, config) {\n    this.gameObject = gameObject;\n    this.scene = GetSceneObject(gameObject); // Event emitter\n\n    this.setEventEmitter(GetValue(config, 'eventEmitter', undefined));\n    var enable = GetValue(config, 'enable', true);\n    var stateConfig = {\n      enable: enable,\n      eventEmitter: false\n    };\n    this._state = new State(this, stateConfig);\n    var drapSpeedConfig = {\n      inputConfig: GetValue(config, 'inputConfig', undefined),\n      enable: enable,\n      eventEmitter: false\n    };\n    this.dragState = new DrapSpeed(gameObject, drapSpeedConfig);\n    this._enable = undefined;\n    this._value = undefined;\n    this._slowDown = new SlowDown();\n    var callback = GetValue(config, 'valuechangeCallback', null);\n\n    if (callback !== null) {\n      var scope = GetValue(config, 'valuechangeCallbackScope', undefined);\n      this.on('valuechange', callback, scope);\n    }\n\n    callback = GetValue(config, 'overmaxCallback', null);\n\n    if (callback !== null) {\n      var scope = GetValue(config, 'overmaxCallbackScope', undefined);\n      this.on('overmax', callback, scope);\n    }\n\n    callback = GetValue(config, 'overminCallback', null);\n\n    if (callback !== null) {\n      var scope = GetValue(config, 'overminCallbackScope', undefined);\n      this.on('overmin', callback, scope);\n    }\n\n    this.resetFromJSON(config);\n    this.boot();\n  }\n\n  resetFromJSON(o) {\n    this.setOrientationMode(GetValue(o, 'orientation', 0));\n    this.setDragThreshold(GetValue(o, 'threshold', 10));\n    this.setSlidingDeceleration(GetValue(o, 'slidingDeceleration', 5000));\n    this.setBackDeceleration(GetValue(o, 'backDeceleration', 2000));\n    var bounds = GetValue(o, 'bounds', undefined);\n\n    if (bounds) {\n      this.setBounds(bounds);\n    } else {\n      this.setBounds(GetValue(o, 'max', 0), GetValue(o, 'min', 0));\n    }\n\n    this.setValue(GetValue(o, 'value', this.maxValue || 0));\n    this.setEnable(GetValue(o, \"enable\", true));\n    return this;\n  }\n\n  boot() {\n    this.scene.events.on('update', this._state.update, this._state);\n    this.gameObject.on('destroy', this.destroy, this);\n  }\n\n  shutdown() {\n    this.destroyEventEmitter();\n\n    if (this.scene) {\n      // Scene might be destoryed\n      this.scene.events.off('update', this._state.update, this._state);\n    }\n\n    this.gameObject = undefined;\n    this.scene = undefined;\n\n    this._state.destroy();\n\n    this.dragState.destroy(); // gameObject events will be removed when this gameObject destroyed \n  }\n\n  destroy() {\n    this.shutdown();\n  }\n\n  get enable() {\n    return this._enable;\n  }\n\n  set enable(e) {\n    if (this._enable === e) {\n      return;\n    }\n\n    this._enable = e;\n\n    this._state.setEnable(e);\n\n    this.dragState.setEnable(e);\n    return this;\n  }\n\n  setEnable(e) {\n    if (e === undefined) {\n      e = true;\n    }\n\n    this.enable = e;\n    return this;\n  }\n\n  toggleEnable() {\n    this.setEnable(!this.enable);\n    return this;\n  }\n\n  setOrientationMode(m) {\n    if (typeof m === 'string') {\n      m = ORIENTATIONMODE[m];\n    }\n\n    this.orientationMode = m;\n    return this;\n  }\n\n  setDragThreshold(distance) {\n    this.dragThreshold = distance;\n    return this;\n  }\n\n  setSlidingDeceleration(dec) {\n    this.slidingDeceleration = dec;\n    return this;\n  }\n\n  setBackDeceleration(dec) {\n    this.backDeceleration = dec;\n    return this;\n  }\n\n  setBounds(value0, value1) {\n    if (Array.isArray(value0)) {\n      var bounds = value0;\n      value0 = bounds[0];\n      value1 = bounds[1];\n    }\n\n    if (value0 < value1) {\n      this.minValue = value0;\n      this.maxValue = value1;\n    } else {\n      this.minValue = value1;\n      this.maxValue = value0;\n    }\n\n    return this;\n  }\n\n  get value() {\n    return this._value;\n  }\n\n  set value(value) {\n    if (value === this._value) {\n      return;\n    }\n\n    var oldValue = this._value;\n    var isOverMax = this.overMax(value);\n    var isOverMin = this.overMin(value);\n\n    if (isOverMax) {\n      this.emit('overmax', value, oldValue);\n    }\n\n    if (isOverMin) {\n      this.emit('overmin', value, oldValue);\n    }\n\n    if (!this.backEnable) {\n      if (isOverMax) {\n        value = this.maxValue;\n      }\n\n      if (isOverMin) {\n        value = this.minValue;\n      }\n    }\n\n    this._value = value;\n    this.emit('valuechange', value, oldValue);\n  }\n\n  setValue(value) {\n    this.value = value;\n  }\n\n  get state() {\n    return this._state.state;\n  }\n\n  get isDragging() {\n    return this.dragState.isInTouched;\n  }\n\n  get outOfMaxBound() {\n    return this.overMax(this.value);\n  }\n\n  get outOfMinBound() {\n    return this.overMin(this.value);\n  }\n\n  get outOfBounds() {\n    return this.outOfMinBound || this.outOfMaxBound;\n  } // internal\n\n\n  overMax(value) {\n    return this.maxValue != null && value > this.maxValue;\n  }\n\n  overMin(value) {\n    return this.minValue != null && value < this.minValue;\n  }\n\n  get backEnable() {\n    return typeof this.backDeceleration === 'number';\n  }\n\n  get isPullBack() {\n    return this._slowDown.isMoving;\n  }\n\n  get slidingEnable() {\n    return typeof this.slidingDeceleration === 'number';\n  }\n\n  get isSliding() {\n    return this._slowDown.isMoving;\n  }\n\n  get dragDelta() {\n    if (this.orientationMode === 0) {\n      // y\n      return this.dragState.dy;\n    } else if (this.orientationMode === 1) {\n      // x\n      return this.dragState.dx;\n    } else {\n      return 0;\n    }\n  }\n\n  get dragSpeed() {\n    if (this.orientationMode === 0) {\n      // y\n      return this.dragState.speedY;\n    } else if (this.orientationMode === 1) {\n      // x\n      return this.dragState.speedX;\n    } else {\n      return 0;\n    }\n  } // everyTick_DRAG\n\n\n  dragging() {\n    this.value += this.dragDelta;\n  } // enter_SLIDE \n\n\n  onSliding() {\n    var start = this.value;\n    var speed = this.dragSpeed;\n\n    if (speed === 0) {\n      this._slowDown.stop();\n\n      this._state.next();\n\n      return;\n    }\n\n    var dec = this.slidingDeceleration;\n\n    this._slowDown.init(start, speed > 0, Math.abs(speed), dec);\n  } // everyTick_SLIDE\n\n\n  sliding(time, delta) {\n    delta *= 0.001;\n\n    var newValue = this._slowDown.update(delta).value;\n\n    if (this.overMax(newValue)) {\n      this.value = this.maxValue;\n\n      this._slowDown.stop();\n    } else if (this.overMin(newValue)) {\n      this.value = this.minValue;\n\n      this._slowDown.stop();\n    } else {\n      this.value = newValue;\n    }\n  } // enter_BACK\n\n\n  onPullBack() {\n    var start = this.value;\n    var end = this.outOfMinBound ? this.minValue : this.maxValue;\n    var dist = Math.abs(end - start);\n    var dec = this.backDeceleration;\n    var speed = Math.sqrt(2 * dec * dist);\n\n    this._slowDown.init(start, undefined, speed, dec, end);\n  } // everyTick_BACK\n\n\n  pullBack(time, delta) {\n    delta *= 0.001;\n    this.value = this._slowDown.update(delta).value;\n\n    if (!this._slowDown.isMoving) {\n      this._state.next();\n    }\n  } // exit_SLIDE, exit_BACK\n\n\n  stop() {\n    this._slowDown.stop();\n  }\n\n}\n\nObject.assign(Scroller.prototype, EventEmitterMethods);\n/** @private */\n\nconst ORIENTATIONMODE = {\n  y: 0,\n  v: 0,\n  vertical: 0,\n  x: 1,\n  h: 1,\n  horizontal: 1\n};\nexport default Scroller;","map":{"version":3,"sources":["/home/jon/code/Projects/Soulys/frontend/node_modules/phaser3-rex-plugins/plugins/input/scroller/Scroller.js"],"names":["GetSceneObject","EventEmitterMethods","State","DrapSpeed","SlowDown","GetValue","Phaser","Utils","Objects","Scroller","constructor","gameObject","config","scene","setEventEmitter","undefined","enable","stateConfig","eventEmitter","_state","drapSpeedConfig","inputConfig","dragState","_enable","_value","_slowDown","callback","scope","on","resetFromJSON","boot","o","setOrientationMode","setDragThreshold","setSlidingDeceleration","setBackDeceleration","bounds","setBounds","setValue","maxValue","setEnable","events","update","destroy","shutdown","destroyEventEmitter","off","e","toggleEnable","m","ORIENTATIONMODE","orientationMode","distance","dragThreshold","dec","slidingDeceleration","backDeceleration","value0","value1","Array","isArray","minValue","value","oldValue","isOverMax","overMax","isOverMin","overMin","emit","backEnable","state","isDragging","isInTouched","outOfMaxBound","outOfMinBound","outOfBounds","isPullBack","isMoving","slidingEnable","isSliding","dragDelta","dy","dx","dragSpeed","speedY","speedX","dragging","onSliding","start","speed","stop","next","init","Math","abs","sliding","time","delta","newValue","onPullBack","end","dist","sqrt","pullBack","Object","assign","prototype","y","v","vertical","x","h","horizontal"],"mappings":"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","sourcesContent":["import GetSceneObject from '../../utils/system/GetSceneObject.js';\r\nimport EventEmitterMethods from '../../utils/eventemitter/EventEmitterMethods.js';\r\nimport State from './State.js';\r\nimport DrapSpeed from '../../dragspeed.js';\r\nimport SlowDown from '../../utils/movement/SlowDown.js';\r\n\r\nconst GetValue = Phaser.Utils.Objects.GetValue;\r\n\r\nclass Scroller {\r\n    constructor(gameObject, config) {\r\n        this.gameObject = gameObject;\r\n        this.scene = GetSceneObject(gameObject);\r\n        // Event emitter\r\n        this.setEventEmitter(GetValue(config, 'eventEmitter', undefined));\r\n\r\n        var enable = GetValue(config, 'enable', true);\r\n        var stateConfig = {\r\n            enable: enable,\r\n            eventEmitter: false,\r\n        }\r\n        this._state = new State(this, stateConfig);\r\n\r\n        var drapSpeedConfig = {\r\n            inputConfig: GetValue(config, 'inputConfig', undefined),\r\n            enable: enable,\r\n            eventEmitter: false,\r\n        };\r\n        this.dragState = new DrapSpeed(gameObject, drapSpeedConfig);\r\n\r\n        this._enable = undefined;\r\n        this._value = undefined;\r\n        this._slowDown = new SlowDown();\r\n\r\n        var callback = GetValue(config, 'valuechangeCallback', null);\r\n        if (callback !== null) {\r\n            var scope = GetValue(config, 'valuechangeCallbackScope', undefined);\r\n            this.on('valuechange', callback, scope);\r\n        }\r\n        callback = GetValue(config, 'overmaxCallback', null);\r\n        if (callback !== null) {\r\n            var scope = GetValue(config, 'overmaxCallbackScope', undefined);\r\n            this.on('overmax', callback, scope);\r\n        }\r\n        callback = GetValue(config, 'overminCallback', null);\r\n        if (callback !== null) {\r\n            var scope = GetValue(config, 'overminCallbackScope', undefined);\r\n            this.on('overmin', callback, scope);\r\n        }\r\n\r\n        this.resetFromJSON(config);\r\n        this.boot();\r\n    }\r\n\r\n    resetFromJSON(o) {\r\n        this.setOrientationMode(GetValue(o, 'orientation', 0));\r\n        this.setDragThreshold(GetValue(o, 'threshold', 10));\r\n        this.setSlidingDeceleration(GetValue(o, 'slidingDeceleration', 5000));\r\n        this.setBackDeceleration(GetValue(o, 'backDeceleration', 2000));\r\n\r\n        var bounds = GetValue(o, 'bounds', undefined);\r\n        if (bounds) {\r\n            this.setBounds(bounds);\r\n        } else {\r\n            this.setBounds(GetValue(o, 'max', 0), GetValue(o, 'min', 0));\r\n        }\r\n        this.setValue(GetValue(o, 'value', this.maxValue || 0));\r\n        this.setEnable(GetValue(o, \"enable\", true));\r\n        return this;\r\n    }\r\n\r\n    boot() {\r\n        this.scene.events.on('update', this._state.update, this._state);\r\n        this.gameObject.on('destroy', this.destroy, this);\r\n    }\r\n\r\n    shutdown() {\r\n        this.destroyEventEmitter();\r\n        if (this.scene) { // Scene might be destoryed\r\n            this.scene.events.off('update', this._state.update, this._state);\r\n        }\r\n        this.gameObject = undefined;\r\n        this.scene = undefined;\r\n        this._state.destroy();\r\n        this.dragState.destroy();\r\n        // gameObject events will be removed when this gameObject destroyed \r\n    }\r\n\r\n    destroy() {\r\n        this.shutdown();\r\n    }\r\n\r\n    get enable() {\r\n        return this._enable;\r\n    }\r\n\r\n    set enable(e) {\r\n        if (this._enable === e) {\r\n            return;\r\n        }\r\n\r\n        this._enable = e;\r\n        this._state.setEnable(e);\r\n        this.dragState.setEnable(e);\r\n        return this;\r\n    }\r\n\r\n    setEnable(e) {\r\n        if (e === undefined) {\r\n            e = true;\r\n        }\r\n\r\n        this.enable = e;\r\n        return this;\r\n    }\r\n\r\n    toggleEnable() {\r\n        this.setEnable(!this.enable);\r\n        return this;\r\n    }\r\n\r\n    setOrientationMode(m) {\r\n        if (typeof (m) === 'string') {\r\n            m = ORIENTATIONMODE[m];\r\n        }\r\n        this.orientationMode = m;\r\n        return this;\r\n    }\r\n\r\n    setDragThreshold(distance) {\r\n        this.dragThreshold = distance;\r\n        return this;\r\n    }\r\n\r\n    setSlidingDeceleration(dec) {\r\n        this.slidingDeceleration = dec;\r\n        return this;\r\n    }\r\n\r\n    setBackDeceleration(dec) {\r\n        this.backDeceleration = dec;\r\n        return this;\r\n    }\r\n\r\n    setBounds(value0, value1) {\r\n        if (Array.isArray(value0)) {\r\n            var bounds = value0;\r\n            value0 = bounds[0];\r\n            value1 = bounds[1];\r\n        }\r\n        if (value0 < value1) {\r\n            this.minValue = value0;\r\n            this.maxValue = value1;\r\n        } else {\r\n            this.minValue = value1;\r\n            this.maxValue = value0;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    get value() {\r\n        return this._value;\r\n    }\r\n\r\n    set value(value) {\r\n        if (value === this._value) {\r\n            return;\r\n        }\r\n\r\n        var oldValue = this._value;\r\n        var isOverMax = this.overMax(value);\r\n        var isOverMin = this.overMin(value);\r\n        if (isOverMax) {\r\n            this.emit('overmax', value, oldValue);\r\n        }\r\n        if (isOverMin) {\r\n            this.emit('overmin', value, oldValue);\r\n        }\r\n        if (!this.backEnable) {\r\n            if (isOverMax) {\r\n                value = this.maxValue;\r\n            }\r\n            if (isOverMin) {\r\n                value = this.minValue;\r\n            }\r\n        }\r\n\r\n        this._value = value;\r\n        this.emit('valuechange', value, oldValue);\r\n    }\r\n\r\n    setValue(value) {\r\n        this.value = value;\r\n    }\r\n\r\n    get state() {\r\n        return this._state.state;\r\n    }\r\n\r\n    get isDragging() {\r\n        return this.dragState.isInTouched;\r\n    }\r\n\r\n    get outOfMaxBound() {\r\n        return this.overMax(this.value);\r\n    }\r\n\r\n    get outOfMinBound() {\r\n        return this.overMin(this.value);\r\n    }\r\n\r\n    get outOfBounds() {\r\n        return this.outOfMinBound || this.outOfMaxBound;\r\n    }\r\n\r\n    // internal\r\n    overMax(value) {\r\n        return (this.maxValue != null) && (value > this.maxValue);\r\n    }\r\n\r\n    overMin(value) {\r\n        return (this.minValue != null) && (value < this.minValue);\r\n    }\r\n\r\n    get backEnable() {\r\n        return (typeof (this.backDeceleration) === 'number');\r\n    }\r\n\r\n    get isPullBack() {\r\n        return this._slowDown.isMoving;\r\n    }\r\n\r\n    get slidingEnable() {\r\n        return (typeof (this.slidingDeceleration) === 'number');\r\n    }\r\n\r\n    get isSliding() {\r\n        return this._slowDown.isMoving;\r\n    }\r\n\r\n    get dragDelta() {\r\n        if (this.orientationMode === 0) { // y\r\n            return this.dragState.dy;\r\n        } else if (this.orientationMode === 1) { // x\r\n            return this.dragState.dx;\r\n        } else {\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    get dragSpeed() {\r\n        if (this.orientationMode === 0) { // y\r\n            return this.dragState.speedY;\r\n        } else if (this.orientationMode === 1) { // x\r\n            return this.dragState.speedX;\r\n        } else {\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    // everyTick_DRAG\r\n    dragging() {\r\n        this.value += this.dragDelta;\r\n    }\r\n\r\n    // enter_SLIDE \r\n    onSliding() {\r\n        var start = this.value;\r\n        var speed = this.dragSpeed;\r\n        if (speed === 0) {\r\n            this._slowDown.stop();\r\n            this._state.next();\r\n            return;\r\n        }\r\n        var dec = this.slidingDeceleration;\r\n        this._slowDown.init(start, (speed > 0), Math.abs(speed), dec)\r\n    }\r\n\r\n    // everyTick_SLIDE\r\n    sliding(time, delta) {\r\n        delta *= 0.001;\r\n        var newValue = this._slowDown.update(delta).value;\r\n        if (this.overMax(newValue)) {\r\n            this.value = this.maxValue;\r\n            this._slowDown.stop();\r\n        } else if (this.overMin(newValue)) {\r\n            this.value = this.minValue;\r\n            this._slowDown.stop();\r\n        } else {\r\n            this.value = newValue;\r\n        }\r\n    }\r\n\r\n    // enter_BACK\r\n    onPullBack() {\r\n        var start = this.value;\r\n        var end = (this.outOfMinBound) ? this.minValue : this.maxValue;\r\n        var dist = Math.abs(end - start);\r\n        var dec = this.backDeceleration;\r\n        var speed = Math.sqrt(2 * dec * dist);\r\n        this._slowDown.init(start, undefined, speed, dec, end);\r\n    }\r\n\r\n    // everyTick_BACK\r\n    pullBack(time, delta) {\r\n        delta *= 0.001;\r\n        this.value = this._slowDown.update(delta).value;\r\n\r\n        if (!this._slowDown.isMoving) {\r\n            this._state.next();\r\n        }\r\n    }\r\n\r\n    // exit_SLIDE, exit_BACK\r\n    stop() {\r\n        this._slowDown.stop();\r\n    }\r\n\r\n}\r\n\r\nObject.assign(\r\n    Scroller.prototype,\r\n    EventEmitterMethods\r\n);\r\n\r\n/** @private */\r\nconst ORIENTATIONMODE = {\r\n    y: 0,\r\n    v: 0,\r\n    vertical: 0,\r\n    x: 1,\r\n    h: 1,\r\n    horizontal: 1,\r\n};\r\n\r\nexport default Scroller;"]},"metadata":{},"sourceType":"module"}