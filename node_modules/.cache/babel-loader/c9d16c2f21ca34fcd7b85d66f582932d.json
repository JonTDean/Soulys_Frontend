{"ast":null,"code":"import EventEmitterMethods from '../../../utils/eventemitter/EventEmitterMethods.js';\nimport Clear from '../../../utils/object/Clear.js';\nconst GetValue = Phaser.Utils.Objects.GetValue;\nconst SpliceOne = Phaser.Utils.Array.SpliceOne;\nconst DistanceBetween = Phaser.Math.Distance.Between;\nconst AngleBetween = Phaser.Math.Angle.Between;\n\nclass TwoPointersTracer {\n  constructor(scene, config) {\n    var amount = scene.input.manager.pointersTotal - 1;\n\n    if (amount < 2) {\n      scene.input.addPointer(2 - amount);\n    }\n\n    this.scene = scene; // Event emitter\n\n    this.setEventEmitter(GetValue(config, 'eventEmitter', undefined));\n    this._enable = undefined;\n    this.pointers = [];\n    this.movedState = {};\n    this.resetFromJSON(config);\n    this.boot();\n  }\n\n  resetFromJSON(o) {\n    this.setEnable(GetValue(o, \"enable\", true));\n    this.bounds = GetValue(o, 'bounds', undefined);\n    this.tracerState = TOUCH0;\n    this.pointers.length = 0;\n    Clear(this.movedState);\n    return this;\n  }\n\n  boot() {\n    this.scene.input.on('pointerdown', this.onPointerDown, this);\n    this.scene.input.on('pointerup', this.onPointerUp, this);\n    this.scene.input.on('pointermove', this.onPointerMove, this);\n    this.scene.events.once('shutdown', this.destroy, this);\n  }\n\n  shutdown() {\n    this.destroyEventEmitter();\n    this.pointers.length = 0;\n    Clear(this.movedState);\n\n    if (this.scene) {\n      this.scene.input.off('pointerdown', this.onPointerDown, this);\n      this.scene.input.off('pointerup', this.onPointerUp, this);\n      this.scene.input.off('pointermove', this.onPointerMove, this);\n      this.scene.events.off('destroy', this.destroy, this);\n      this.scene = undefined;\n    }\n\n    this.scene = undefined;\n  }\n\n  destroy() {\n    this.shutdown();\n  }\n\n  get enable() {\n    return this._enable;\n  }\n\n  set enable(e) {\n    if (this._enable === e) {\n      return;\n    }\n\n    if (!e) {\n      this.dragCancel();\n    }\n\n    this._enable = e;\n    return this;\n  }\n\n  setEnable(e) {\n    if (e === undefined) {\n      e = true;\n    }\n\n    this.enable = e;\n    return this;\n  }\n\n  toggleEnable() {\n    this.setEnable(!this.enable);\n    return this;\n  }\n\n  onPointerDown(pointer) {\n    if (!this.enable) {\n      return;\n    }\n\n    if (this.pointers.length === 2) {\n      return;\n    }\n\n    var isInsideBounds = this.bounds ? this.bounds.contains(pointer.x, pointer.y) : true;\n\n    if (!isInsideBounds) {\n      return;\n    }\n\n    var index = this.pointers.indexOf(pointer);\n\n    if (index !== -1) {\n      // Already in catched pointers\n      return;\n    }\n\n    this.movedState[pointer.id] = false;\n    this.pointers.push(pointer);\n\n    switch (this.tracerState) {\n      case TOUCH0:\n        this.tracerState = TOUCH1;\n        this.onDrag1Start();\n        break;\n\n      case TOUCH1:\n        this.tracerState = TOUCH2;\n        this.onDrag2Start();\n        break;\n    }\n  }\n\n  onPointerUp(pointer) {\n    if (!this.enable) {\n      return;\n    }\n\n    var isInsideBounds = this.bounds ? this.bounds.contains(pointer.x, pointer.y) : true;\n\n    if (!isInsideBounds) {\n      return;\n    }\n\n    var index = this.pointers.indexOf(pointer);\n\n    if (index === -1) {\n      // Not in catched pointers\n      return;\n    } else {\n      delete this.movedState[pointer.id];\n      SpliceOne(this.pointers, index);\n    }\n\n    switch (this.tracerState) {\n      case TOUCH1:\n        this.tracerState = TOUCH0;\n        this.onDrag1End();\n        break;\n\n      case TOUCH2:\n        this.tracerState = TOUCH1;\n        this.onDrag2End();\n        this.onDrag1Start();\n        break;\n    }\n  }\n\n  onPointerMove(pointer) {\n    if (!this.enable) {\n      return;\n    }\n\n    if (pointer.isDown) {\n      var isInsideBounds = this.bounds ? this.bounds.contains(pointer.x, pointer.y) : true;\n      var isCatchedPointer = this.pointers.indexOf(pointer) !== -1;\n\n      if (!isCatchedPointer && isInsideBounds) {// Pointer moves into bounds\n        // this.onPointerDown(pointer);\n      } else if (isCatchedPointer && !isInsideBounds) {\n        // Pointer moves out of bounds, lose pointer\n        this.onPointerUp(pointer);\n      } else {\n        // Pointer drags in bounds\n        if (!this.movedState[pointer.id]) {\n          this.movedState[pointer.id] = pointer.x !== pointer.downX || pointer.y !== pointer.downY;\n        }\n\n        if (this.movedState[pointer.id]) {\n          switch (this.tracerState) {\n            case TOUCH1:\n              this.onDrag1();\n              break;\n\n            case TOUCH2:\n              this.onDrag2();\n              break;\n          }\n        }\n      }\n    }\n  }\n\n  dragCancel() {\n    if (this.tracerState === TOUCH2) {\n      this.onDrag2End();\n    }\n\n    this.pointers.length = 0;\n    Clear(this.movedState);\n    this.tracerState = TOUCH0;\n    return this;\n  }\n\n  onDrag1Start() {\n    this.emit('drag1start', this);\n  }\n\n  onDrag1End() {\n    this.emit('drag1end', this);\n  }\n\n  onDrag1() {\n    this.emit('drag1', this);\n  }\n\n  onDrag2Start() {\n    this.emit('drag2start', this);\n  }\n\n  onDrag2End() {\n    this.emit('drag2end', this);\n  }\n\n  onDrag2() {\n    this.emit('drag2', this);\n  }\n\n  get distanceBetween() {\n    if (this.tracerState !== TOUCH2) {\n      return 0;\n    }\n\n    var p0 = this.pointers[0],\n        p1 = this.pointers[1];\n    return DistanceBetween(p0.x, p0.y, p1.x, p1.y);\n  }\n\n  get angleBetween() {\n    if (this.tracerState !== TOUCH2) {\n      return 0;\n    }\n\n    var p0 = this.pointers[0],\n        p1 = this.pointers[1];\n    return AngleBetween(p0.x, p0.y, p1.x, p1.y);\n  }\n\n  get drag1Vector() {\n    var pointer = this.pointers[0];\n\n    if (pointer && this.movedState[pointer.id]) {\n      var p1 = pointer.position;\n      var p0 = pointer.prevPosition;\n      tmpDragVector.x = p1.x - p0.x;\n      tmpDragVector.y = p1.y - p0.y;\n    } else {\n      tmpDragVector.x = 0;\n      tmpDragVector.y = 0;\n    }\n\n    return tmpDragVector;\n  }\n\n  get centerX() {\n    if (this.tracerState !== TOUCH2) {\n      return 0;\n    }\n\n    var p0 = this.pointers[0].position;\n    var p1 = this.pointers[1].position;\n    return (p0.x + p1.x) / 2;\n  }\n\n  get centerY() {\n    if (this.tracerState !== TOUCH2) {\n      return 0;\n    }\n\n    var p0 = this.pointers[0].position;\n    var p1 = this.pointers[1].position;\n    return (p0.y + p1.y) / 2;\n  }\n\n  get prevCenterX() {\n    if (this.tracerState !== TOUCH2) {\n      return 0;\n    }\n\n    var preP0 = this.movedState[this.pointers[0].id] ? this.pointers[0].prevPosition : this.pointers[0].position;\n    var preP1 = this.movedState[this.pointers[1].id] ? this.pointers[1].prevPosition : this.pointers[1].position;\n    return (preP0.x + preP1.x) / 2;\n  }\n\n  get prevCenterY() {\n    if (this.tracerState !== TOUCH2) {\n      return 0;\n    }\n\n    var preP0 = this.movedState[this.pointers[0].id] ? this.pointers[0].prevPosition : this.pointers[0].position;\n    var preP1 = this.movedState[this.pointers[1].id] ? this.pointers[1].prevPosition : this.pointers[1].position;\n    return (preP0.y + preP1.y) / 2;\n  }\n\n  get movementCenterX() {\n    return this.centerX - this.prevCenterX;\n  }\n\n  get movementCenterY() {\n    return this.centerY - this.prevCenterY;\n  }\n\n  setRecongizedStateObject(stateObject) {\n    this.recongizedState = stateObject;\n    return this;\n  }\n\n  get state() {\n    return this.recongizedState.state;\n  }\n\n  set state(newState) {\n    this.recongizedState.state = newState;\n  }\n\n  cancel() {\n    this.state = IDLE;\n    return this;\n  }\n\n}\n\nObject.assign(TwoPointersTracer.prototype, EventEmitterMethods);\nvar tmpDragVector = {};\nconst TOUCH0 = 0;\nconst TOUCH1 = 1;\nconst TOUCH2 = 2;\nconst IDLE = 'IDLE';\nexport default TwoPointersTracer;","map":{"version":3,"sources":["/home/jon/code/Projects/Soulys/frontend/node_modules/phaser3-rex-plugins/plugins/input/gestures/twopointerstracer/TwoPointersTracer.js"],"names":["EventEmitterMethods","Clear","GetValue","Phaser","Utils","Objects","SpliceOne","Array","DistanceBetween","Math","Distance","Between","AngleBetween","Angle","TwoPointersTracer","constructor","scene","config","amount","input","manager","pointersTotal","addPointer","setEventEmitter","undefined","_enable","pointers","movedState","resetFromJSON","boot","o","setEnable","bounds","tracerState","TOUCH0","length","on","onPointerDown","onPointerUp","onPointerMove","events","once","destroy","shutdown","destroyEventEmitter","off","enable","e","dragCancel","toggleEnable","pointer","isInsideBounds","contains","x","y","index","indexOf","id","push","TOUCH1","onDrag1Start","TOUCH2","onDrag2Start","onDrag1End","onDrag2End","isDown","isCatchedPointer","downX","downY","onDrag1","onDrag2","emit","distanceBetween","p0","p1","angleBetween","drag1Vector","position","prevPosition","tmpDragVector","centerX","centerY","prevCenterX","preP0","preP1","prevCenterY","movementCenterX","movementCenterY","setRecongizedStateObject","stateObject","recongizedState","state","newState","cancel","IDLE","Object","assign","prototype"],"mappings":"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","sourcesContent":["import EventEmitterMethods from '../../../utils/eventemitter/EventEmitterMethods.js';\r\nimport Clear from '../../../utils/object/Clear.js';\r\n\r\nconst GetValue = Phaser.Utils.Objects.GetValue;\r\nconst SpliceOne = Phaser.Utils.Array.SpliceOne;\r\nconst DistanceBetween = Phaser.Math.Distance.Between;\r\nconst AngleBetween = Phaser.Math.Angle.Between;\r\n\r\nclass TwoPointersTracer {\r\n    constructor(scene, config) {\r\n        var amount = scene.input.manager.pointersTotal - 1;\r\n        if (amount < 2) {\r\n            scene.input.addPointer(2 - amount);\r\n        }\r\n\r\n        this.scene = scene;\r\n        // Event emitter\r\n        this.setEventEmitter(GetValue(config, 'eventEmitter', undefined));\r\n\r\n        this._enable = undefined;\r\n        this.pointers = [];\r\n        this.movedState = {};\r\n        this.resetFromJSON(config);\r\n        this.boot();\r\n    }\r\n\r\n    resetFromJSON(o) {\r\n        this.setEnable(GetValue(o, \"enable\", true));\r\n        this.bounds = GetValue(o, 'bounds', undefined);\r\n\r\n        this.tracerState = TOUCH0;\r\n        this.pointers.length = 0;\r\n        Clear(this.movedState);\r\n        return this;\r\n    }\r\n\r\n    boot() {\r\n        this.scene.input.on('pointerdown', this.onPointerDown, this);\r\n        this.scene.input.on('pointerup', this.onPointerUp, this);\r\n        this.scene.input.on('pointermove', this.onPointerMove, this);\r\n        this.scene.events.once('shutdown', this.destroy, this);\r\n    }\r\n\r\n    shutdown() {\r\n        this.destroyEventEmitter();\r\n        this.pointers.length = 0;\r\n        Clear(this.movedState);\r\n        if (this.scene) {\r\n            this.scene.input.off('pointerdown', this.onPointerDown, this);\r\n            this.scene.input.off('pointerup', this.onPointerUp, this);\r\n            this.scene.input.off('pointermove', this.onPointerMove, this);\r\n            this.scene.events.off('destroy', this.destroy, this);\r\n            this.scene = undefined;\r\n        }\r\n        this.scene = undefined;\r\n    }\r\n\r\n    destroy() {\r\n        this.shutdown();\r\n    }\r\n\r\n    get enable() {\r\n        return this._enable;\r\n    }\r\n\r\n    set enable(e) {\r\n        if (this._enable === e) {\r\n            return;\r\n        }\r\n\r\n        if (!e) {\r\n            this.dragCancel();\r\n        }\r\n        this._enable = e;\r\n        return this;\r\n    }\r\n\r\n    setEnable(e) {\r\n        if (e === undefined) {\r\n            e = true;\r\n        }\r\n\r\n        this.enable = e;\r\n        return this;\r\n    }\r\n\r\n    toggleEnable() {\r\n        this.setEnable(!this.enable);\r\n        return this;\r\n    }\r\n\r\n    onPointerDown(pointer) {\r\n        if (!this.enable) {\r\n            return;\r\n        }\r\n\r\n        if (this.pointers.length === 2) {\r\n            return;\r\n        }\r\n\r\n        var isInsideBounds = (this.bounds) ? this.bounds.contains(pointer.x, pointer.y) : true;\r\n        if (!isInsideBounds) {\r\n            return;\r\n        }\r\n\r\n        var index = this.pointers.indexOf(pointer);\r\n        if (index !== -1) { // Already in catched pointers\r\n            return;\r\n        }\r\n\r\n        this.movedState[pointer.id] = false;\r\n        this.pointers.push(pointer);\r\n\r\n        switch (this.tracerState) {\r\n            case TOUCH0:\r\n                this.tracerState = TOUCH1;\r\n                this.onDrag1Start();\r\n                break;\r\n            case TOUCH1:\r\n                this.tracerState = TOUCH2;\r\n                this.onDrag2Start();\r\n                break;\r\n        }\r\n    }\r\n\r\n    onPointerUp(pointer) {\r\n        if (!this.enable) {\r\n            return;\r\n        }\r\n\r\n        var isInsideBounds = (this.bounds) ? this.bounds.contains(pointer.x, pointer.y) : true;\r\n        if (!isInsideBounds) {\r\n            return;\r\n        }\r\n\r\n        var index = this.pointers.indexOf(pointer);\r\n        if (index === -1) { // Not in catched pointers\r\n            return;\r\n        } else {\r\n            delete this.movedState[pointer.id];\r\n            SpliceOne(this.pointers, index);\r\n        }\r\n\r\n        switch (this.tracerState) {\r\n            case TOUCH1:\r\n                this.tracerState = TOUCH0;\r\n                this.onDrag1End();\r\n                break;\r\n            case TOUCH2:\r\n                this.tracerState = TOUCH1;\r\n                this.onDrag2End();\r\n                this.onDrag1Start();\r\n                break;\r\n        }\r\n    }\r\n\r\n    onPointerMove(pointer) {\r\n        if (!this.enable) {\r\n            return;\r\n        }\r\n\r\n        if (pointer.isDown) {\r\n            var isInsideBounds = (this.bounds) ? this.bounds.contains(pointer.x, pointer.y) : true;\r\n            var isCatchedPointer = (this.pointers.indexOf(pointer) !== -1);\r\n            if (!isCatchedPointer && isInsideBounds) { // Pointer moves into bounds\r\n                // this.onPointerDown(pointer);\r\n            } else if (isCatchedPointer && !isInsideBounds) { // Pointer moves out of bounds, lose pointer\r\n                this.onPointerUp(pointer);\r\n            } else {  // Pointer drags in bounds\r\n                if (!this.movedState[pointer.id]) {\r\n                    this.movedState[pointer.id] = (pointer.x !== pointer.downX) || (pointer.y !== pointer.downY);\r\n                }\r\n                if (this.movedState[pointer.id]) {\r\n                    switch (this.tracerState) {\r\n                        case TOUCH1:\r\n                            this.onDrag1();\r\n                            break;\r\n                        case TOUCH2:\r\n                            this.onDrag2();\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    dragCancel() {\r\n        if (this.tracerState === TOUCH2) {\r\n            this.onDrag2End();\r\n        }\r\n        this.pointers.length = 0;\r\n        Clear(this.movedState);\r\n        this.tracerState = TOUCH0;\r\n        return this;\r\n    }\r\n\r\n    onDrag1Start() {\r\n        this.emit('drag1start', this);\r\n    }\r\n\r\n    onDrag1End() {\r\n        this.emit('drag1end', this);\r\n    }\r\n\r\n    onDrag1() {\r\n        this.emit('drag1', this);\r\n    }\r\n\r\n    onDrag2Start() {\r\n        this.emit('drag2start', this);\r\n    }\r\n\r\n    onDrag2End() {\r\n        this.emit('drag2end', this);\r\n    }\r\n\r\n    onDrag2() {\r\n        this.emit('drag2', this);\r\n    }\r\n\r\n    get distanceBetween() {\r\n        if (this.tracerState !== TOUCH2) {\r\n            return 0;\r\n        }\r\n        var p0 = this.pointers[0],\r\n            p1 = this.pointers[1];\r\n        return DistanceBetween(p0.x, p0.y, p1.x, p1.y);\r\n    }\r\n\r\n    get angleBetween() {\r\n        if (this.tracerState !== TOUCH2) {\r\n            return 0;\r\n        }\r\n        var p0 = this.pointers[0],\r\n            p1 = this.pointers[1];\r\n        return AngleBetween(p0.x, p0.y, p1.x, p1.y);\r\n    }\r\n\r\n    get drag1Vector() {\r\n        var pointer = this.pointers[0];\r\n        if (pointer && this.movedState[pointer.id]) {\r\n            var p1 = pointer.position;\r\n            var p0 = pointer.prevPosition;\r\n            tmpDragVector.x = p1.x - p0.x;\r\n            tmpDragVector.y = p1.y - p0.y;\r\n        } else {\r\n            tmpDragVector.x = 0;\r\n            tmpDragVector.y = 0;\r\n        }\r\n        return tmpDragVector;\r\n    }\r\n\r\n    get centerX() {\r\n        if (this.tracerState !== TOUCH2) {\r\n            return 0;\r\n        }\r\n        var p0 = this.pointers[0].position;\r\n        var p1 = this.pointers[1].position;\r\n        return (p0.x + p1.x) / 2;\r\n    }\r\n\r\n    get centerY() {\r\n        if (this.tracerState !== TOUCH2) {\r\n            return 0;\r\n        }\r\n        var p0 = this.pointers[0].position;\r\n        var p1 = this.pointers[1].position;\r\n        return (p0.y + p1.y) / 2;\r\n    }\r\n\r\n    get prevCenterX() {\r\n        if (this.tracerState !== TOUCH2) {\r\n            return 0;\r\n        }\r\n        var preP0 = (this.movedState[this.pointers[0].id]) ? this.pointers[0].prevPosition : this.pointers[0].position;\r\n        var preP1 = (this.movedState[this.pointers[1].id]) ? this.pointers[1].prevPosition : this.pointers[1].position;\r\n        return (preP0.x + preP1.x) / 2;\r\n    }\r\n\r\n    get prevCenterY() {\r\n        if (this.tracerState !== TOUCH2) {\r\n            return 0;\r\n        }\r\n        var preP0 = (this.movedState[this.pointers[0].id]) ? this.pointers[0].prevPosition : this.pointers[0].position;\r\n        var preP1 = (this.movedState[this.pointers[1].id]) ? this.pointers[1].prevPosition : this.pointers[1].position;\r\n        return (preP0.y + preP1.y) / 2;\r\n    }\r\n\r\n    get movementCenterX() {\r\n        return this.centerX - this.prevCenterX;\r\n    }\r\n\r\n    get movementCenterY() {\r\n        return this.centerY - this.prevCenterY;\r\n    }\r\n\r\n    setRecongizedStateObject(stateObject) {\r\n        this.recongizedState = stateObject;\r\n        return this;\r\n    }\r\n\r\n    get state() {\r\n        return this.recongizedState.state;\r\n    }\r\n\r\n    set state(newState) {\r\n        this.recongizedState.state = newState;\r\n    }\r\n\r\n    cancel() {\r\n        this.state = IDLE;\r\n        return this;\r\n    }\r\n}\r\n\r\nObject.assign(\r\n    TwoPointersTracer.prototype,\r\n    EventEmitterMethods\r\n);\r\n\r\nvar tmpDragVector = {};\r\n\r\nconst TOUCH0 = 0;\r\nconst TOUCH1 = 1;\r\nconst TOUCH2 = 2;\r\n\r\nconst IDLE = 'IDLE';\r\n\r\nexport default TwoPointersTracer;"]},"metadata":{},"sourceType":"module"}