{"ast":null,"code":"import TextStyle from '../textbase/textstyle/TextStyle.js';\nvar GETPROP_RESULT = {\n  plainText: null,\n  prevProp: null\n};\nvar STYLE_RESULT = new TextStyle();\nvar PROPLIST = [];\n\nclass parser {\n  constructor(tags) {\n    if (tags === undefined) {\n      tags = {};\n    }\n\n    this.tags = tags;\n  }\n\n  addTag(name, prop) {\n    this.tags[name] = prop;\n  }\n\n  splitText(text, mode) {\n    var result = [];\n    var arr,\n        m,\n        charIdx = 0,\n        totalLen = text.length,\n        matchStart = totalLen;\n    var innerMatch;\n\n    while (true) {\n      arr = RE_SPLITTEXT.exec(text);\n\n      if (!arr) {\n        break;\n      }\n\n      m = arr[0];\n      matchStart = RE_SPLITTEXT.lastIndex - m.length;\n\n      if (charIdx < matchStart) {\n        result.push(text.substring(charIdx, matchStart));\n      }\n\n      if (mode === undefined) {\n        result.push(m);\n      } else if (mode === 1) {\n        // RAWTEXTONLY_MODE\n        if (RE_CLASS_HEADER.test(m)) {\n          innerMatch = m.match(RE_CLASS);\n          result.push(innerMatch[2]);\n        } else if (RE_STYLE_HEADER.test(m)) {\n          innerMatch = m.match(RE_STYLE);\n          result.push(innerMatch[2]);\n        }\n      }\n\n      charIdx = RE_SPLITTEXT.lastIndex;\n    }\n\n    if (charIdx < totalLen) {\n      result.push(text.substring(charIdx, totalLen));\n    }\n\n    return result; // [text,...]\n  }\n\n  tagTextToProp(text, prevProp) {\n    var plainText, propOut;\n\n    if (RE_CLASS_HEADER.test(text)) {\n      var innerMatch = text.match(RE_CLASS);\n\n      if (innerMatch != null) {\n        var name = innerMatch[1];\n        var tags = this.tags;\n\n        if (tags.hasOwnProperty(name)) {\n          propOut = tags[name];\n        } else {\n          propOut = {};\n        }\n\n        propOut._class = name;\n        plainText = innerMatch[2];\n      }\n    } else if (RE_STYLE_HEADER.test(text)) {\n      var innerMatch = text.match(RE_STYLE);\n\n      if (innerMatch != null) {\n        var style = innerMatch[1];\n        propOut = styleToProp(style);\n        propOut._style = style;\n        plainText = innerMatch[2];\n      }\n    }\n\n    if (plainText == null) {\n      plainText = text;\n    }\n\n    if (propOut == null) {\n      propOut = {};\n    }\n\n    var result = GETPROP_RESULT;\n    result.plainText = plainText;\n    result.prop = propOut;\n    return result;\n  }\n\n  propToContextStyle(defaultStyle, prop) {\n    var result = STYLE_RESULT;\n\n    if (!prop.hasOwnProperty('img')) {\n      result.image = null;\n\n      if (prop.hasOwnProperty('family') || prop.hasOwnProperty('fontFamily') || prop.hasOwnProperty('font-family')) {\n        var family = prop.hasOwnProperty('family') ? prop.family : prop.hasOwnProperty('fontFamily') ? prop.fontFamily : prop['font-family'];\n        result.fontFamily = family;\n      } else {\n        result.fontFamily = defaultStyle.fontFamily;\n      }\n\n      if (prop.hasOwnProperty('size') || prop.hasOwnProperty('fontSize') || prop.hasOwnProperty('font-size')) {\n        var size = prop.hasOwnProperty('size') ? prop.size : prop.hasOwnProperty('fontSize') ? prop.fontSize : prop['font-size'];\n\n        if (typeof size === 'number') {\n          size = size.toString() + 'px';\n        }\n\n        result.fontSize = size;\n      } else {\n        result.fontSize = defaultStyle.fontSize;\n      }\n\n      if (prop.hasOwnProperty('style') || prop.hasOwnProperty('fontStyle') || prop.hasOwnProperty('font-style')) {\n        var fontStyle = prop.hasOwnProperty('style') ? prop.style : prop.hasOwnProperty('fontStyle') ? prop.fontStyle : prop['font-style'];\n        result.fontStyle = fontStyle;\n      } else {\n        result.fontStyle = defaultStyle.fontStyle;\n      }\n\n      if (prop.hasOwnProperty('color') || prop.hasOwnProperty('font-color')) {\n        var color = prop.hasOwnProperty('color') ? prop.color : prop['font-color'];\n        result.color = color;\n      } else {\n        result.color = defaultStyle.color;\n      }\n\n      if (prop.hasOwnProperty('stroke')) {\n        var stroke = prop.stroke; // {color, thinkness}\n\n        result.stroke = stroke.hasOwnProperty('color') ? stroke.color : defaultStyle.stroke;\n        result.strokeThickness = stroke.hasOwnProperty('thinkness') ? stroke.thinkness : defaultStyle.strokeThickness;\n      } else {\n        result.stroke = defaultStyle.stroke;\n        result.strokeThickness = defaultStyle.strokeThickness;\n      }\n    } else {\n      result.image = prop.img;\n    }\n\n    if (prop.hasOwnProperty('shadow')) {\n      var shadow = prop.shadow; // {color, offsetX, offsetY, blur}\n\n      result.shadowColor = shadow.hasOwnProperty('color') ? shadow.color : defaultStyle.shadowColor;\n      result.shadowOffsetX = shadow.hasOwnProperty('offsetX') ? shadow.offsetX : defaultStyle.shadowOffsetX;\n      result.shadowOffsetY = shadow.hasOwnProperty('offsetY') ? shadow.offsetY : defaultStyle.shadowOffsetY;\n      result.shadowBlur = shadow.hasOwnProperty('blur') ? shadow.blur : defaultStyle.shadowBlur;\n      result.shadowStroke = true;\n      result.shadowFill = true;\n    } else {\n      result.shadowColor = defaultStyle.shadowColor;\n      result.shadowOffsetX = defaultStyle.shadowOffsetX;\n      result.shadowOffsetY = defaultStyle.shadowOffsetY;\n      result.shadowBlur = defaultStyle.shadowBlur;\n      result.shadowStroke = defaultStyle.shadowStroke;\n      result.shadowFill = defaultStyle.shadowFill;\n    }\n\n    if (prop.hasOwnProperty('u') || prop.hasOwnProperty('underline')) {\n      var u = prop.hasOwnProperty('u') ? prop.u : prop.underline; // {color, thinkness, offset}\n\n      result.underlineColor = u.hasOwnProperty('color') ? u.color : defaultStyle.underlineColor;\n      result.underlineThickness = u.hasOwnProperty('thinkness') ? u.thinkness : defaultStyle.underlineThickness;\n      result.underlineOffset = u.hasOwnProperty('offset') ? u.offset : defaultStyle.underlineOffset;\n    } else {\n      result.underlineColor = defaultStyle.underlineColor;\n      result.underlineThickness = defaultStyle.underlineThickness;\n      result.underlineOffset = defaultStyle.underlineOffset;\n    }\n\n    return result;\n  }\n\n  propToTagText(text, prop, prevProp) {\n    if (prop.hasOwnProperty('_class')) {\n      // class mode\n      if (text === '') {\n        if (this.isTextTag(prop._class)) {\n          return '';\n        }\n      }\n\n      return \"<class='\" + prop._class + \"'>\" + text + \"</class>\";\n    } else if (prop.hasOwnProperty('_style')) {\n      // class mode\n      return \"<style='\" + prop._style + \"'>\" + text + \"</style>\";\n    }\n  }\n\n  destroy() {\n    this.tags = undefined;\n  }\n\n  isTextTag(tagName) {\n    var tag = this.tags[tagName];\n\n    if (tag) {\n      return tag.img == null;\n    } else {\n      // tag not found\n      return false;\n    }\n  }\n\n}\n\n;\n\nvar styleToProp = function (s) {\n  s = s.split(\";\");\n  var result = {},\n      prop,\n      k,\n      v;\n\n  for (var i = 0, slen = s.length; i < slen; i++) {\n    prop = s[i].split(\":\");\n    k = prop[0], v = prop[1];\n\n    if (isEmpty(k) || isEmpty(v)) {\n      continue;\n    }\n\n    switch (k) {\n      case 'stroke':\n        var stroke = v.split(' '); // stroke:blue 1px\n\n        var len = stroke.length;\n        v = {};\n\n        if (len >= 1) {\n          v.color = stroke[0];\n        }\n\n        if (len >= 2) {\n          v.thinkness = parseInt(stroke[1].replace('px', ''));\n        }\n\n        break;\n\n      case 'shadow':\n        var shadow = v.split(' '); // shadow:blue 2px 2px 2px\n\n        var len = shadow.length;\n        v = {};\n\n        if (len >= 1) {\n          v.color = shadow[0];\n        }\n\n        if (len >= 2) {\n          v.offsetX = parseInt(shadow[1].replace('px', ''));\n        }\n\n        if (len >= 3) {\n          v.offsetY = parseInt(shadow[2].replace('px', ''));\n        }\n\n        if (len >= 4) {\n          v.blur = parseInt(shadow[3].replace('px', ''));\n        }\n\n        break;\n\n      case 'u':\n      case 'underline':\n        // underline:blue 3px -1px\n        var u = v.split(' ');\n        var len = u.length;\n        v = {};\n\n        if (len >= 1) {\n          v.color = u[0];\n        }\n\n        if (len >= 2) {\n          v.thinkness = parseInt(u[1].replace('px', ''));\n        }\n\n        if (len >= 3) {\n          v.offset = parseInt(u[2].replace('px', ''));\n        }\n\n        break;\n    }\n\n    result[k] = v;\n  }\n\n  return result;\n};\n\nvar isEmpty = function (s) {\n  // Remove white spaces.\n  s = s.replace(RE_SPACE, '');\n  return s.length === 0;\n};\n\nvar RE_SPLITTEXT = /<\\s*class=[\"|']([^\"|']+)[\"|']\\s*\\>([\\s\\S]*?)<\\s*\\/class\\s*\\>|<\\s*style=[\"|']([^\"|']+)[\"|']\\s*\\>([\\s\\S]*?)<\\s*\\/style\\s*\\>/g;\nvar RE_CLASS_HEADER = /<\\s*class=/i;\nvar RE_CLASS = /<\\s*class=[\"|']([^\"|']+)[\"|']\\s*\\>([\\s\\S]*?)<\\s*\\/class\\s*\\>/;\nvar RE_STYLE_HEADER = /<\\s*style=/i;\nvar RE_STYLE = /<\\s*style=[\"|']([^\"|']+)[\"|']\\s*\\>([\\s\\S]*?)<\\s*\\/style\\s*\\>/;\nvar RE_SPACE = /^\\s+|\\s+$/;\nexport default parser;","map":{"version":3,"sources":["/home/jon/code/Projects/Soulys/frontend/node_modules/phaser3-rex-plugins/plugins/gameobjects/text/tagtext/Parser.js"],"names":["TextStyle","GETPROP_RESULT","plainText","prevProp","STYLE_RESULT","PROPLIST","parser","constructor","tags","undefined","addTag","name","prop","splitText","text","mode","result","arr","m","charIdx","totalLen","length","matchStart","innerMatch","RE_SPLITTEXT","exec","lastIndex","push","substring","RE_CLASS_HEADER","test","match","RE_CLASS","RE_STYLE_HEADER","RE_STYLE","tagTextToProp","propOut","hasOwnProperty","_class","style","styleToProp","_style","propToContextStyle","defaultStyle","image","family","fontFamily","size","fontSize","toString","fontStyle","color","stroke","strokeThickness","thinkness","img","shadow","shadowColor","shadowOffsetX","offsetX","shadowOffsetY","offsetY","shadowBlur","blur","shadowStroke","shadowFill","u","underline","underlineColor","underlineThickness","underlineOffset","offset","propToTagText","isTextTag","destroy","tagName","tag","s","split","k","v","i","slen","isEmpty","len","parseInt","replace","RE_SPACE"],"mappings":"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","sourcesContent":["import TextStyle from '../textbase/textstyle/TextStyle.js';\r\n\r\nvar GETPROP_RESULT = {\r\n    plainText: null,\r\n    prevProp: null\r\n};\r\n\r\nvar STYLE_RESULT = new TextStyle();\r\nvar PROPLIST = [];\r\n\r\nclass parser {\r\n    constructor(tags) {\r\n        if (tags === undefined) {\r\n            tags = {};\r\n        }\r\n        this.tags = tags;\r\n    }\r\n\r\n    addTag(name, prop) {\r\n        this.tags[name] = prop;\r\n    }\r\n\r\n    splitText(text, mode) {\r\n        var result = [];\r\n        var arr, m, charIdx = 0,\r\n            totalLen = text.length,\r\n            matchStart = totalLen;\r\n        var innerMatch;\r\n        while (true) {\r\n            arr = RE_SPLITTEXT.exec(text);\r\n            if (!arr) {\r\n                break;\r\n            }\r\n\r\n            m = arr[0];\r\n            matchStart = RE_SPLITTEXT.lastIndex - m.length;\r\n\r\n            if (charIdx < matchStart) {\r\n                result.push(text.substring(charIdx, matchStart));\r\n            }\r\n            if (mode === undefined) {\r\n                result.push(m);\r\n            } else if (mode === 1) { // RAWTEXTONLY_MODE\r\n                if (RE_CLASS_HEADER.test(m)) {\r\n                    innerMatch = m.match(RE_CLASS);\r\n                    result.push(innerMatch[2]);\r\n                } else if (RE_STYLE_HEADER.test(m)) {\r\n                    innerMatch = m.match(RE_STYLE);\r\n                    result.push(innerMatch[2]);\r\n                }\r\n            }\r\n\r\n            charIdx = RE_SPLITTEXT.lastIndex;\r\n        }\r\n\r\n\r\n        if (charIdx < totalLen) {\r\n            result.push(text.substring(charIdx, totalLen));\r\n        }\r\n        return result; // [text,...]\r\n    }\r\n\r\n    tagTextToProp(text, prevProp) {\r\n        var plainText, propOut;\r\n        if (RE_CLASS_HEADER.test(text)) {\r\n            var innerMatch = text.match(RE_CLASS);\r\n            if (innerMatch != null) {\r\n                var name = innerMatch[1];\r\n                var tags = this.tags;\r\n                if (tags.hasOwnProperty(name)) {\r\n                    propOut = tags[name];\r\n                } else {\r\n                    propOut = {};\r\n                }\r\n                propOut._class = name;\r\n                plainText = innerMatch[2];\r\n            }\r\n        } else if (RE_STYLE_HEADER.test(text)) {\r\n            var innerMatch = text.match(RE_STYLE);\r\n            if (innerMatch != null) {\r\n                var style = innerMatch[1];\r\n                propOut = styleToProp(style);\r\n                propOut._style = style;\r\n                plainText = innerMatch[2];\r\n            }\r\n        }\r\n\r\n        if (plainText == null) {\r\n            plainText = text;\r\n        }\r\n\r\n        if (propOut == null) {\r\n            propOut = {};\r\n        }\r\n\r\n        var result = GETPROP_RESULT;\r\n        result.plainText = plainText;\r\n        result.prop = propOut;\r\n        return result;\r\n    }\r\n\r\n    propToContextStyle(defaultStyle, prop) {\r\n        var result = STYLE_RESULT;\r\n        if (!prop.hasOwnProperty('img')) {\r\n            result.image = null;\r\n\r\n            if (prop.hasOwnProperty('family') || prop.hasOwnProperty('fontFamily') || prop.hasOwnProperty('font-family')) {\r\n                var family = (prop.hasOwnProperty('family')) ? prop.family :\r\n                    (prop.hasOwnProperty('fontFamily')) ? prop.fontFamily :\r\n                    prop['font-family'];\r\n                result.fontFamily = family;\r\n            } else {\r\n                result.fontFamily = defaultStyle.fontFamily;\r\n            }\r\n\r\n            if (prop.hasOwnProperty('size') || prop.hasOwnProperty('fontSize') || prop.hasOwnProperty('font-size')) {\r\n                var size = (prop.hasOwnProperty('size')) ? prop.size :\r\n                    (prop.hasOwnProperty('fontSize')) ? prop.fontSize :\r\n                    prop['font-size'];\r\n                if (typeof (size) === 'number') {\r\n                    size = size.toString() + 'px';\r\n                }\r\n                result.fontSize = size;\r\n            } else {\r\n                result.fontSize = defaultStyle.fontSize;\r\n            }\r\n\r\n            if (prop.hasOwnProperty('style') || prop.hasOwnProperty('fontStyle') || prop.hasOwnProperty('font-style')) {\r\n                var fontStyle = (prop.hasOwnProperty('style')) ? prop.style :\r\n                    (prop.hasOwnProperty('fontStyle')) ? prop.fontStyle :\r\n                    prop['font-style'];\r\n                result.fontStyle = fontStyle;\r\n            } else {\r\n                result.fontStyle = defaultStyle.fontStyle;\r\n            }\r\n\r\n            if (prop.hasOwnProperty('color') || prop.hasOwnProperty('font-color')) {\r\n                var color = (prop.hasOwnProperty('color')) ? prop.color : prop['font-color'];\r\n                result.color = color;\r\n            } else {\r\n                result.color = defaultStyle.color;\r\n            }\r\n\r\n            if (prop.hasOwnProperty('stroke')) {\r\n                var stroke = prop.stroke; // {color, thinkness}\r\n                result.stroke = (stroke.hasOwnProperty('color')) ? stroke.color : defaultStyle.stroke;\r\n                result.strokeThickness = (stroke.hasOwnProperty('thinkness')) ? stroke.thinkness : defaultStyle.strokeThickness;\r\n            } else {\r\n                result.stroke = defaultStyle.stroke;\r\n                result.strokeThickness = defaultStyle.strokeThickness;\r\n            }\r\n        } else {\r\n            result.image = prop.img;\r\n        }\r\n\r\n        if (prop.hasOwnProperty('shadow')) {\r\n            var shadow = prop.shadow; // {color, offsetX, offsetY, blur}\r\n            result.shadowColor = (shadow.hasOwnProperty('color')) ? shadow.color : defaultStyle.shadowColor;\r\n            result.shadowOffsetX = (shadow.hasOwnProperty('offsetX')) ? shadow.offsetX : defaultStyle.shadowOffsetX;\r\n            result.shadowOffsetY = (shadow.hasOwnProperty('offsetY')) ? shadow.offsetY : defaultStyle.shadowOffsetY;\r\n            result.shadowBlur = (shadow.hasOwnProperty('blur')) ? shadow.blur : defaultStyle.shadowBlur;\r\n            result.shadowStroke = true;\r\n            result.shadowFill = true;\r\n        } else {\r\n            result.shadowColor = defaultStyle.shadowColor;\r\n            result.shadowOffsetX = defaultStyle.shadowOffsetX;\r\n            result.shadowOffsetY = defaultStyle.shadowOffsetY;\r\n            result.shadowBlur = defaultStyle.shadowBlur;\r\n            result.shadowStroke = defaultStyle.shadowStroke;\r\n            result.shadowFill = defaultStyle.shadowFill;\r\n        }\r\n\r\n        if (prop.hasOwnProperty('u') || prop.hasOwnProperty('underline')) {\r\n            var u = (prop.hasOwnProperty('u')) ? prop.u : prop.underline; // {color, thinkness, offset}\r\n            result.underlineColor = (u.hasOwnProperty('color')) ? u.color : defaultStyle.underlineColor;\r\n            result.underlineThickness = (u.hasOwnProperty('thinkness')) ? u.thinkness : defaultStyle.underlineThickness;\r\n            result.underlineOffset = (u.hasOwnProperty('offset')) ? u.offset : defaultStyle.underlineOffset;\r\n        } else {\r\n            result.underlineColor = defaultStyle.underlineColor;\r\n            result.underlineThickness = defaultStyle.underlineThickness;\r\n            result.underlineOffset = defaultStyle.underlineOffset;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    propToTagText(text, prop, prevProp) {\r\n        if (prop.hasOwnProperty('_class')) { // class mode\r\n            if (text === '') {\r\n                if (this.isTextTag(prop._class)) {\r\n                    return '';\r\n                }\r\n            }\r\n            return \"<class='\" + prop._class + \"'>\" + text + \"</class>\";\r\n        } else if (prop.hasOwnProperty('_style')) { // class mode\r\n            return \"<style='\" + prop._style + \"'>\" + text + \"</style>\";\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        this.tags = undefined;\r\n    }\r\n\r\n    isTextTag(tagName) {\r\n        var tag = this.tags[tagName];\r\n        if (tag) {\r\n            return (tag.img == null);\r\n        } else { // tag not found\r\n            return false;\r\n        }\r\n    }\r\n};\r\n\r\nvar styleToProp = function (s) {\r\n    s = s.split(\";\");\r\n\r\n    var result = {},\r\n        prop, k, v;\r\n    for (var i = 0, slen = s.length; i < slen; i++) {\r\n        prop = s[i].split(\":\");\r\n        k = prop[0], v = prop[1];\r\n        if (isEmpty(k) || isEmpty(v)) {\r\n            continue;\r\n        }\r\n\r\n        switch (k) {\r\n            case 'stroke':\r\n                var stroke = v.split(' '); // stroke:blue 1px\r\n                var len = stroke.length;\r\n                v = {};\r\n                if (len >= 1) {\r\n                    v.color = stroke[0];\r\n                }\r\n                if (len >= 2) {\r\n                    v.thinkness = parseInt(stroke[1].replace('px', ''));\r\n                }\r\n                break;\r\n            case 'shadow':\r\n                var shadow = v.split(' '); // shadow:blue 2px 2px 2px\r\n                var len = shadow.length;\r\n                v = {};\r\n                if (len >= 1) {\r\n                    v.color = shadow[0];\r\n                }\r\n                if (len >= 2) {\r\n                    v.offsetX = parseInt(shadow[1].replace('px', ''));\r\n                }\r\n                if (len >= 3) {\r\n                    v.offsetY = parseInt(shadow[2].replace('px', ''));\r\n                }\r\n                if (len >= 4) {\r\n                    v.blur = parseInt(shadow[3].replace('px', ''));\r\n                }\r\n                break;\r\n            case 'u':\r\n            case 'underline': // underline:blue 3px -1px\r\n                var u = v.split(' ');\r\n                var len = u.length;\r\n                v = {};\r\n                if (len >= 1) {\r\n                    v.color = u[0];\r\n                }\r\n                if (len >= 2) {\r\n                    v.thinkness = parseInt(u[1].replace('px', ''));\r\n                }\r\n                if (len >= 3) {\r\n                    v.offset = parseInt(u[2].replace('px', ''));\r\n                }\r\n                break;\r\n        }\r\n        result[k] = v;\r\n    }\r\n    return result;\r\n};\r\n\r\nvar isEmpty = function (s) {\r\n    // Remove white spaces.\r\n    s = s.replace(RE_SPACE, '');\r\n    return (s.length === 0);\r\n};\r\n\r\nvar RE_SPLITTEXT = /<\\s*class=[\"|']([^\"|']+)[\"|']\\s*\\>([\\s\\S]*?)<\\s*\\/class\\s*\\>|<\\s*style=[\"|']([^\"|']+)[\"|']\\s*\\>([\\s\\S]*?)<\\s*\\/style\\s*\\>/g;\r\nvar RE_CLASS_HEADER = /<\\s*class=/i;\r\nvar RE_CLASS = /<\\s*class=[\"|']([^\"|']+)[\"|']\\s*\\>([\\s\\S]*?)<\\s*\\/class\\s*\\>/;\r\nvar RE_STYLE_HEADER = /<\\s*style=/i;\r\nvar RE_STYLE = /<\\s*style=[\"|']([^\"|']+)[\"|']\\s*\\>([\\s\\S]*?)<\\s*\\/style\\s*\\>/;\r\nvar RE_SPACE = /^\\s+|\\s+$/;\r\n\r\nexport default parser;"]},"metadata":{},"sourceType":"module"}